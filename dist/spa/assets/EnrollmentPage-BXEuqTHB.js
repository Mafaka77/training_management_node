import{a as ot,Q as V}from"./QTabs-DJFrMzO1.js";import{k as r,m as b,n as o,p as e,M as h,s as t,O as i,q as k,I as g,$ as D,L as w,J as S,K as A,r as q,w as L,Q as $,a7 as G,U as nt,W as H,a0 as U,a3 as Q,y as lt,N as E,f as N}from"./index-CyB-vvD0.js";import{Q as J}from"./QChip-CzhZjiW0.js";import{Q as T}from"./QRating-DoyzTADg.js";import{Q as P}from"./QImg-TlMSzmnx.js";import{Q as z}from"./QBadge-DDryG4iz.js";import{Q as rt}from"./QList-DIiSaAAv.js";import{Q as dt}from"./QPage-BrmjLk10.js";import{C as B}from"./ClosePopup-Bhn8Avt2.js";import{d as K}from"./date-CpP9PQHG.js";import{u as F}from"./use-quasar-DLt-hrEL.js";import{Q as j}from"./QItemLabel-Ci-IQEZX.js";import{a as ct,Q as mt}from"./QItemSection-Z7u5r7C5.js";import{_ as ut}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QResizeObserver-Cw9KoLIc.js";import"./rtl-DFPa-2ov.js";import"./format-DyQxkAtJ.js";const gt={class:"text-caption text-grey"},pt={key:0,class:"text-caption q-mt-xs"},_t={key:0},vt={key:1},W={__name:"StatusCard",props:{title:String,status:String,enrolledDate:String,extra:String,color:String},setup(d){const v=y=>y?K.formatDate(y,"DD MMM YYYY"):"N/A";return(y,n)=>(r(),b(w,{flat:""},{default:o(()=>[e(h,null,{default:o(()=>[t("div",gt,i(d.title),1),e(z,{color:d.color,class:"q-mt-xs"},{default:o(()=>[k(i(d.status),1)]),_:1},8,["color"]),d.enrolledDate||d.extra?(r(),g("div",pt,[d.enrolledDate?(r(),g("span",_t,"Enrolled on "+i(v(d.enrolledDate)),1)):D("",!0),d.extra?(r(),g("span",vt,i(d.extra),1)):D("",!0)])):D("",!0)]),_:1})]),_:1}))}},yt={class:"row items-center q-mt-sm"},xt={class:"col-12 col-sm-6"},ft={class:"text-body2"},bt={class:"col-12 col-sm-6"},ht={class:"text-body2"},wt={key:0,class:"q-mt-md"},qt={class:"row q-col-gutter-xs"},$t={key:1,class:"q-mt-md text-caption text-italic text-grey"},Dt={__name:"TrainingSession",props:{course:{type:Object,required:!0}},setup(d){const v=F(),y=u=>{const m=`https://staging2.egovmz.in${u.file_url}`;window.open(m,"_blank"),v.notify({type:"info",message:`Downloading ${u.file_name}`})},n=u=>u.length>20?u.slice(0,17)+"...":u,f=u=>u?new Date(u).toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"}):"N/A";return(u,m)=>(r(),b(mt,{class:"q-pa-none q-mb-sm"},{default:o(()=>[e(ct,{class:"q-pa-md bg-grey-2 rounded-borders"},{default:o(()=>[e(j,{class:"text-weight-bold text-body1"},{default:o(()=>[k(i(d.course.tc_topic),1)]),_:1}),e(j,{caption:"",class:"q-mt-xs"},{default:o(()=>[k(i(d.course.tc_description),1)]),_:1}),t("div",yt,[t("div",xt,[m[0]||(m[0]=t("div",{class:"text-caption text-grey"},"Session",-1)),t("div",ft,"Session "+i(d.course.tc_session),1)]),t("div",bt,[m[1]||(m[1]=t("div",{class:"text-caption text-grey"},"Schedule",-1)),t("div",ht,i(f(d.course.tc_start_time))+" - "+i(f(d.course.tc_end_time)),1)])]),d.course.materials&&d.course.materials.length?(r(),g("div",wt,[m[2]||(m[2]=t("div",{class:"text-caption text-weight-medium q-mb-xs"},"Training Materials:",-1)),t("div",qt,[(r(!0),g(S,null,A(d.course.materials,x=>(r(),g("div",{key:x._id,class:"col-auto"},[e(J,{clickable:"",onClick:C=>y(x),icon:"description",size:"sm",title:x.file_name},{default:o(()=>[k(i(n(x.file_name)),1)]),_:2},1032,["onClick","title"])]))),128))])])):(r(),g("div",$t," No materials available for this session "))]),_:1})]),_:1}))}},kt={key:0,class:"q-mt-sm"},Ct={class:"row items-center q-gutter-sm q-mt-xs"},Rt={class:"text-body2"},Qt={class:"text-body2 q-mt-sm"},Nt={class:"text-caption text-grey q-mt-xs"},St={key:1,class:"q-mt-sm"},At={class:"column items-center q-gutter-y-md"},Vt={class:"text-body2"},Et={__name:"RatingSection",props:{existingRating:Object,trainingId:String,showDialog:Boolean},emits:["update:showDialog","submitted"],setup(d,{emit:v}){const y=F(),n=d,f=v,u=q(n.showDialog);L(()=>n.showDialog,p=>u.value=p),L(u,p=>f("update:showDialog",p));const m=q({rating:0,review:""}),x=async()=>{try{const p={rating:m.value.rating,review:m.value.review||""};await Q.post(`/api/training/${n.trainingId}/ratings`,p),y.notify({type:"positive",message:"Rating submitted successfully!"}),u.value=!1,m.value={rating:0,review:""},f("submitted")}catch(p){y.notify({type:"negative",message:"Failed to submit rating",err:p})}},C=p=>p?new Date(p).toLocaleDateString():"N/A";return(p,c)=>(r(),b(w,{flat:"",class:"q-mb-md bg-blue-1"},{default:o(()=>[e(h,null,{default:o(()=>[c[10]||(c[10]=t("div",{class:"text-h6 text-weight-bold"},"Rate This Training",-1)),d.existingRating?(r(),g("div",kt,[c[6]||(c[6]=t("div",{class:"text-body1"},"Your Rating:",-1)),t("div",Ct,[e(T,{"model-value":d.existingRating.rating,size:"2em",color:"orange",readonly:""},null,8,["model-value"]),t("span",Rt,"("+i(d.existingRating.rating)+"/5)",1)]),t("div",Qt,[c[5]||(c[5]=t("strong",null,"Your Review:",-1)),k(" "+i(d.existingRating.review),1)]),t("div",Nt,"Rated on "+i(C(d.existingRating.createdAt)),1),e($,{label:"Edit Rating",color:"primary",outline:"",class:"q-mt-md",onClick:c[0]||(c[0]=_=>u.value=!0)})])):(r(),g("div",St,[c[7]||(c[7]=t("div",{class:"text-body2 q-mb-md"}," Share your experience with this training program to help others. ",-1)),e($,{label:"Add Rating & Review",color:"primary",icon:"star",onClick:c[1]||(c[1]=_=>u.value=!0)})])),e(G,{modelValue:u.value,"onUpdate:modelValue":c[4]||(c[4]=_=>u.value=_),persistent:""},{default:o(()=>[e(w,{style:{"min-width":"400px"}},{default:o(()=>[e(h,null,{default:o(()=>[...c[8]||(c[8]=[t("div",{class:"text-h6"},"Rate Training Program",-1)])]),_:1}),e(h,{class:"q-pt-none"},{default:o(()=>[t("div",At,[c[9]||(c[9]=t("div",{class:"text-body1"},"How would you rate this training?",-1)),e(T,{modelValue:m.value.rating,"onUpdate:modelValue":c[2]||(c[2]=_=>m.value.rating=_),size:"3em",color:"orange",icon:"star_border","icon-selected":"star"},null,8,["modelValue"]),t("div",Vt,i(m.value.rating)+"/5",1),e(nt,{modelValue:m.value.review,"onUpdate:modelValue":c[3]||(c[3]=_=>m.value.review=_),label:"Your Review (Optional)",type:"textarea",rows:"3",outlined:"",placeholder:"Share your experience...",class:"full-width"},null,8,["modelValue"])])]),_:1}),e(H,{align:"right"},{default:o(()=>[U(e($,{flat:"",label:"Cancel",color:"primary"},null,512),[[B]]),e($,{label:"Submit Rating",color:"primary",disable:m.value.rating===0,onClick:x},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}},Mt={class:"row q-col-gutter-md"},Ut={key:0,class:"absolute-full flex flex-center bg-grey-4",style:{height:"180px"}},Tt={class:"absolute-bottom bg-gradient-to-top text-white q-pa-md"},zt={class:"text-h6 q-mb-xs"},Bt={class:"text-caption ellipsis"},Ft={class:"row items-center q-mt-xs justify-between"},Ot={class:"row items-center"},Yt={class:"text-caption q-ml-xs"},It={class:"row items-center justify-between q-mb-xs"},Lt={class:"text-subtitle2 text-primary text-weight-medium"},Pt={class:"row items-center justify-between q-mt-xs"},jt={class:"text-caption text-grey"},Wt={class:"text-caption text-grey q-mt-xs"},Gt={class:"text-caption text-grey"},Ht={class:"text-caption text-grey"},Jt={class:"text-body2 q-mt-sm ellipsis-3-lines"},Kt={class:"row items-center q-mt-xs"},Xt={class:"text-caption text-grey q-ml-xs"},Zt={class:"absolute-bottom bg-gradient-to-top from-black/60 text-white q-pa-md"},te={class:"text-h5 text-weight-bold ellipsis"},ee={key:1,class:"banner-fallback flex flex-center bg-grey-3"},ae={class:"q-mt-sm text-body1"},se={class:"row q-col-gutter-md q-mt-md"},ie={class:"text-caption text-grey"},oe={class:"text-body1 text-weight-medium"},ne={class:"row q-col-gutter-md q-mb-md"},le={class:"q-mt-sm"},re={class:"text-body1 text-weight-medium"},de={class:"text-caption text-grey"},ce={class:"text-caption text-grey"},me={class:"text-caption q-mb-sm"},ue={__name:"EnrollmentPage",setup(d){const v=F(),y=q([]),n=q({}),f=q(!1),u=q(!1),m=q(null),x=q("all"),C=async()=>{try{const s=await Q.get("/api/enrollments");y.value=s.data.enrollments||[]}catch{v.notify({type:"negative",message:"Failed to load enrollments"})}},p=N(()=>x.value==="all"?y.value:y.value.filter(s=>s.training_program?.t_status===x.value)),c=s=>s?s.startsWith("http://")||s.startsWith("https://")?s:s.startsWith("/")?`${Q.defaults.baseURL}${s}`:`${Q.defaults.baseURL}/uploads/${s}`:"",_=s=>s?K.formatDate(s,"DD MMM YYYY"):"N/A",M=s=>({Upcoming:"blue",Ongoing:"green",Finished:"grey"})[s]||"primary",O=s=>({Pending:"orange",Approved:"green",Rejected:"red",Completed:"primary"})[s]||"grey",X=N(()=>{const s=n.value.training_program||{};return[{label:"Start Date",value:_(s.t_start_date)},{label:"End Date",value:_(s.t_end_date)},{label:"Duration",value:`${s.t_duration||0} days`},{label:"Category",value:s.t_category?.name||"N/A"}]}),Y=N(()=>{const s=n.value.status;return["Approved","Completed","Finished"].includes(s)}),I=N(()=>(n.value.training_program?.trainingCourse||[]).reduce((l,a)=>l+(a.materials?.length||0),0)),Z=N(()=>I.value>0),tt=async s=>{n.value=s,f.value=!0,Y.value&&await et()},et=async()=>{try{const s=n.value.training_program?._id;if(!s)return;const l=await Q.get(`/api/training/${s}/ratings`);m.value=l.data.rating||null}catch{m.value=null}},at=async()=>{v.dialog({title:"Cancel Enrollment",message:"Are you sure you want to cancel this enrollment?",cancel:!0,persistent:!0}).onOk(async()=>{try{await Q.patch(`/api/enrollment/${n.value._id}`,{status:"Cancelled"}),v.notify({type:"positive",message:"Enrollment cancelled"}),f.value=!1,C()}catch{v.notify({type:"negative",message:"Failed to cancel enrollment"})}})},st=s=>{const l=`https://staging2.egovmz.in${s.file_url}`;window.open(l,"_blank")},it=()=>{const s=n.value.training_program?.trainingCourse?.flatMap(l=>l.materials||[])||[];if(!s.length)return v.notify({type:"info",message:"No materials to download"});v.notify({type:"positive",message:`Opening ${s.length} materials`}),s.forEach(st)};return lt(C),(s,l)=>(r(),b(dt,{class:"q-pa-md"},{default:o(()=>[l[10]||(l[10]=t("div",{class:"text-h5 text-weight-bold q-mb-lg"},"My Enrollments",-1)),e(ot,{modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=a=>x.value=a),dense:"",class:"text-primary q-mb-md",align:"left","active-color":"primary","indicator-color":"primary"},{default:o(()=>[e(V,{name:"all",label:"All"}),e(V,{name:"Upcoming",label:"Upcoming"}),e(V,{name:"Ongoing",label:"Ongoing"}),e(V,{name:"Finished",label:"Finished"})]),_:1},8,["modelValue"]),t("div",Mt,[(r(!0),g(S,null,A(p.value,a=>(r(),g("div",{key:a._id,class:"col-12 col-md-6 col-lg-4"},[e(w,{flat:"",bordered:"",class:"cursor-pointer hoverable-card",onClick:R=>tt(a)},{default:o(()=>[e(P,{src:c(a.training_program?.t_banner),ratio:16/9,alt:"Training Banner",class:"training-banner rounded-borders"},{default:o(()=>[a.training_program?.t_banner?D("",!0):(r(),g("div",Ut,[e(E,{name:"image",size:"48px",color:"grey-6"}),l[3]||(l[3]=t("div",{class:"text-grey-6 q-mt-md"},"No Banner Available",-1))])),t("div",Tt,[t("div",zt,i(a.training_program?.t_name||"N/A"),1),t("div",Bt,i(a.training_program?.t_description||"No description available"),1),t("div",Ft,[e(J,{dense:"",color:M(a.training_program?.t_status),"text-color":"white"},{default:o(()=>[k(i(a.training_program?.t_status||"Unknown"),1)]),_:2},1032,["color"]),t("div",Ot,[e(T,{modelValue:a.training_program.averageRating,"onUpdate:modelValue":R=>a.training_program.averageRating=R,max:"5",color:"yellow",readonly:"",size:"18px"},null,8,["modelValue","onUpdate:modelValue"]),t("div",Yt," ("+i(a.training_program.ratingsCount||0)+") ",1)])])])]),_:2},1032,["src"]),e(h,null,{default:o(()=>[t("div",It,[t("div",Lt,i(a.training_program?.t_category?.name||"General"),1),e(z,{color:M(a.training_program?.t_status),label:a.training_program?.t_status,align:"middle",class:"text-uppercase"},null,8,["color","label"])]),t("div",Pt,[t("div",jt," Enrolled On: "+i(_(a.enrolledAt)),1),e(z,{color:O(a.status),outline:"",align:"middle"},{default:o(()=>[k(i(a.status),1)]),_:2},1032,["color"])]),t("div",Wt,i(_(a.training_program?.t_start_date))+" → "+i(_(a.training_program?.t_end_date))+" • Duration: "+i(a.training_program?.t_duration||0)+" days ",1),t("div",Gt," Organizer: "+i(a.training_program?.t_organizer||"N/A")+" • Eligibility: "+i(a.training_program?.t_eligibility||"N/A"),1),t("div",Ht," Category: "+i(a.training_program?.t_category?.name||"N/A")+" • Capacity: "+i(a.training_program?.t_capacity||"N/A"),1),t("div",Jt,i(a.training_program?.t_description||"No description available"),1),t("div",Kt,[(r(!0),g(S,null,A(Math.round(a.training_program?.averageRating||0),R=>(r(),b(E,{key:R,name:"star",color:"amber",size:"16px"}))),128)),t("span",Xt," ("+i(a.training_program?.ratingsCount||0)+") ",1)])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]),e(G,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=a=>f.value=a),maximized:""},{default:o(()=>[e(w,{class:"enrollment-dialog-card q-relative"},{default:o(()=>[n.value.training_program?.t_banner?(r(),b(P,{key:0,src:c(n.value.training_program.t_banner),class:"banner-image",alt:"Training Banner"},{default:o(()=>[t("div",Zt,[t("div",te,i(n.value.training_program?.t_name),1),l[4]||(l[4]=t("div",{class:"text-subtitle2 ellipsis"}," Enrollment Details ",-1))])]),_:1},8,["src"])):(r(),g("div",ee,[e(E,{name:"image",size:"64px",color:"grey-5"}),l[5]||(l[5]=t("div",{class:"text-h6 text-grey-6 q-ml-md"},"No Banner Available",-1))])),U(e($,{flat:"",round:"",icon:"close",class:"absolute-top-right text-white"},null,512),[[B]]),e(h,{class:"scroll q-pa-md",style:{"max-height":"75vh","overflow-y":"auto"}},{default:o(()=>[e(w,{flat:"",bordered:"",class:"q-mb-md shadow-1"},{default:o(()=>[e(h,null,{default:o(()=>[l[6]||(l[6]=t("div",{class:"section-title"},"Program Overview",-1)),t("p",ae,i(n.value.training_program?.t_description||"No description available"),1),t("div",se,[(r(!0),g(S,null,A(X.value,(a,R)=>(r(),g("div",{class:"col-12 col-sm-6",key:R},[t("div",ie,i(a.label),1),t("div",oe,i(a.value),1)]))),128))])]),_:1})]),_:1}),t("div",ne,[e(W,{title:"Enrollment Status",status:n.value.status,date:n.value.enrolledAt,color:O(n.value.status)},null,8,["status","date","color"]),e(W,{title:"Program Status",status:n.value.training_program?.t_status,extra:`Capacity: ${n.value.training_program?.t_capacity||0}`,color:M(n.value.training_program?.t_status)},null,8,["status","extra","color"])]),e(w,{flat:"",bordered:"",class:"q-mb-md shadow-1"},{default:o(()=>[e(h,null,{default:o(()=>[l[7]||(l[7]=t("div",{class:"section-title"},"Training Location",-1)),t("div",le,[e(E,{name:"location_on",size:"18px",class:"q-mr-xs text-primary"}),t("span",re,i(n.value.training_program?.t_room?.room_name||"N/A"),1),t("div",de," Room No: "+i(n.value.training_program?.t_room?.room_no||"N/A"),1),t("div",ce," Capacity: "+i(n.value.training_program?.t_room?.capacity||"N/A")+" people ",1)])]),_:1})]),_:1}),Y.value?(r(),b(Et,{key:0,"existing-rating":m.value,showDialog:u.value,"onUpdate:showDialog":l[1]||(l[1]=a=>u.value=a),"training-id":n.value.training_program?._id,onSubmitted:C},null,8,["existing-rating","showDialog","training-id"])):D("",!0),e(w,{flat:"",bordered:"",class:"q-mb-md shadow-1"},{default:o(()=>[e(h,null,{default:o(()=>[l[8]||(l[8]=t("div",{class:"section-title"},"Training Sessions",-1)),e(rt,{separator:""},{default:o(()=>[(r(!0),g(S,null,A(n.value.training_program?.trainingCourse||[],a=>(r(),b(Dt,{key:a._id,course:a},null,8,["course"]))),128))]),_:1})]),_:1})]),_:1}),Z.value?(r(),b(w,{key:1,flat:"",bordered:"",class:"q-mb-md bg-green-1 shadow-1"},{default:o(()=>[e(h,null,{default:o(()=>[l[9]||(l[9]=t("div",{class:"section-title"},"Training Materials",-1)),t("div",me," Total "+i(I.value)+" materials available across all sessions ",1),e($,{label:"Download All Materials",color:"primary",icon:"download",onClick:it})]),_:1})]),_:1})):D("",!0)]),_:1}),e(H,{align:"right",class:"q-pa-md"},{default:o(()=>[U(e($,{flat:"",label:"Close",color:"primary"},null,512),[[B]]),n.value.status==="Pending"?(r(),b($,{key:0,label:"Cancel Enrollment",color:"negative",onClick:at})):D("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ne=ut(ue,[["__scopeId","data-v-ead0bb47"]]);export{Ne as default};
