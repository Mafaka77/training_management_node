import{Q as V}from"./QSelect-JXd70JCl.js";import{y as T,k as n,I as r,s as o,p as a,n as i,N as p,U as c,Q as x,a5 as j,J as L,K as J,$,L as A,M as w,O as m,a6 as K,a0 as W,a7 as X,a3 as v,r as d,f as S,q as U,X as G,W as H}from"./index-BFQVnkeD.js";import{Q as Y}from"./QPagination-3NT97Nxz.js";import{Q as Z}from"./QForm-BT1M9ZeC.js";import{C as ee}from"./ClosePopup-C7U-2yK_.js";import{u as le}from"./use-quasar-DANKxKaF.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-DfQm8PkW.js";import"./QItemSection-DwMX_uwU.js";import"./QItemLabel-CE04gojx.js";import"./QMenu-_RHIY6Py.js";import"./position-engine-C7g5UB-x.js";import"./selection-Bt0zPBy8.js";import"./rtl-DFPa-2ov.js";import"./format-DyQxkAtJ.js";const te={class:"q-pa-lg bg-grey-1"},se={class:"row items-center justify-between q-mb-lg"},oe={class:"row items-center q-gutter-sm"},de={key:0,class:"flex flex-center q-mt-xl"},ie={key:1,class:"text-center q-pa-lg text-grey"},ne={key:2,class:"row q-col-gutter-md"},re={class:"text-h6"},ue={class:"text-caption text-grey-3"},me={class:"q-mb-xs"},pe={class:"q-mb-xs"},ce={class:"q-mb-xs"},ve={key:3,class:"q-mt-lg q-pa-md flex flex-center column"},ge={class:"text-h6"},fe={class:"row q-col-gutter-md"},ye={class:"col-12 col-md-6"},_e={class:"col-12 col-md-6"},be={key:0,class:"col-12 col-md-6"},Ve={class:"col-12 col-md-6"},xe={class:"col-12 col-md-6"},we={class:"col-12 col-md-6"},Ue={class:"col-12 col-md-6"},he={class:"col-12"},qe={class:"row justify-end q-gutter-sm q-pt-md"},ke={__name:"UserPage",setup(Qe){const u=le(),g=d([]),N=d([]),D=d([]),h=d(!1),f=d(!1),q=d(""),y=d(!1),k=d(null),Q=d(null),C=d(1),_=d(6),s=d({full_name:"",email:"",password:"",mobile:"",district:"",department:"",designation:"",roles:["68b01472d1838d6cd773d6fb"]}),P=[{label:"Admin",value:"admin"},{label:"Trainer",value:"trainer"},{label:"Trainee",value:"trainee"}],b=async()=>{h.value=!0;try{const t=`/admin-api/users?search=${q.value}&role=${Q.value||""}&page=1&limit=100`,l=await v.get(t);g.value=l.data.users||[]}catch(t){u.notify({type:"negative",message:"Failed to fetch users.",err:t})}finally{h.value=!1}},F=S(()=>Math.ceil(g.value.length/_.value)),z=S(()=>{const t=(C.value-1)*_.value;return g.value.slice(t,t+_.value)}),M=async()=>{try{y.value?(await v.put(`/admin-api/users/${k.value}`,s.value),u.notify({type:"positive",message:"User updated successfully!"})):(await v.post("/admin-api/create-user",s.value),u.notify({type:"positive",message:"User created successfully!"})),f.value=!1,B(),b()}catch(t){const l=t.response?.data?.message||"Error saving user.";u.notify({type:"negative",message:l})}},R=t=>{y.value=!0,k.value=t._id,s.value={...t,district:t.district?._id||"",department:t.department?._id||"",roles:t.roles?.[0]?._id||t.roles?.[0]?.name||"trainee",password:""},f.value=!0},I=async t=>{u.dialog({title:"Confirm Delete",message:"Are you sure you want to delete this user?",cancel:!0,persistent:!0}).onOk(async()=>{try{await v.delete(`/admin-api/users/${t}`),u.notify({type:"positive",message:"User deleted!"}),b()}catch{u.notify({type:"negative",message:"Failed to delete user."})}})},B=()=>{y.value=!1,k.value=null,s.value={full_name:"",email:"",password:"",mobile:"",district:"",department:"",designation:"",roles:["68b01472d1838d6cd773d6fb"]}},E=async()=>{try{const[t,l]=await Promise.all([v.get("/admin-api/get-all-district"),v.get("/admin-api/departments?limit=100")]);N.value=t.data.districts||[],D.value=l.data.departments||[]}catch(t){console.error("Dropdown fetch failed:",t)}};return T(()=>{b(),E()}),(t,l)=>(n(),r("div",te,[o("div",se,[l[14]||(l[14]=o("div",{class:"text-h5 text-primary text-weight-bold"},"ðŸ‘¥ User Management",-1)),o("div",oe,[a(V,{modelValue:Q.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>Q.value=e),b],options:P,label:"Filter by Role",outlined:"",dense:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"]),a(c,{dense:"",debounce:"300",modelValue:q.value,"onUpdate:modelValue":[l[1]||(l[1]=e=>q.value=e),b],placeholder:"Search users...",outlined:"",rounded:"",clearable:""},{append:i(()=>[a(p,{name:"search"})]),_:1},8,["modelValue"]),a(x,{color:"primary",icon:"add",label:"Add User",onClick:l[2]||(l[2]=e=>f.value=!0),rounded:"",unelevated:""})])]),h.value?(n(),r("div",de,[a(j,{color:"primary",size:"3em"})])):g.value.length?(n(),r("div",ne,[(n(!0),r(L,null,J(z.value,e=>(n(),r("div",{key:e._id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[a(A,{class:"user-card shadow-2"},{default:i(()=>[a(w,{class:"bg-primary text-white"},{default:i(()=>[o("div",re,m(e.full_name),1),o("div",ue,m(e.roles?.[0]?.name||"User"),1)]),_:2},1024),a(w,null,{default:i(()=>[o("div",me,[a(p,{name:"email",size:"16px",class:"q-mr-xs"}),U(" "+m(e.email),1)]),o("div",pe,[a(p,{name:"phone",size:"16px",class:"q-mr-xs"}),U(" "+m(e.mobile||"N/A"),1)]),o("div",ce,[a(p,{name:"work",size:"16px",class:"q-mr-xs"}),U(" "+m(e.department?.name||"N/A"),1)]),o("div",null,[a(p,{name:"badge",size:"16px",class:"q-mr-xs"}),U(" "+m(e.designation||"N/A"),1)])]),_:2},1024),a(G),a(H,{align:"right"},{default:i(()=>[a(x,{flat:"",dense:"",icon:"edit",color:"primary",onClick:O=>R(e)},null,8,["onClick"]),a(x,{flat:"",dense:"",icon:"delete",color:"negative",onClick:O=>I(e._id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])):(n(),r("div",ie,[a(p,{name:"people_outline",size:"48px",color:"grey-6"}),l[15]||(l[15]=o("div",{class:"text-subtitle1 q-mt-sm"},"No users found",-1))])),g.value.length?(n(),r("div",ve,[a(Y,{modelValue:C.value,"onUpdate:modelValue":l[3]||(l[3]=e=>C.value=e),max:F.value,"max-pages":"7","boundary-numbers":"","direction-links":"",color:"primary",class:"q-mb-md"},null,8,["modelValue","max"]),a(V,{modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=e=>_.value=e),options:[6,12,24],label:"Rows per page",outlined:"",dense:"",style:{width:"150px"}},null,8,["modelValue"])])):$("",!0),a(X,{modelValue:f.value,"onUpdate:modelValue":l[13]||(l[13]=e=>f.value=e),persistent:""},{default:i(()=>[a(A,{style:{"min-width":"480px"},class:"q-pa-md"},{default:i(()=>[a(w,{class:"bg-primary text-white"},{default:i(()=>[o("div",ge,m(y.value?"Edit User":"Add New User"),1)]),_:1}),a(w,null,{default:i(()=>[a(Z,{onSubmit:K(M,["prevent"]),class:"q-gutter-md q-pt-md"},{default:i(()=>[o("div",fe,[o("div",ye,[a(c,{modelValue:s.value.full_name,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.full_name=e),label:"Full Name",outlined:"",dense:""},null,8,["modelValue"])]),o("div",_e,[a(c,{modelValue:s.value.email,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.email=e),label:"Email",outlined:"",dense:"",type:"email"},null,8,["modelValue"])]),y.value?$("",!0):(n(),r("div",be,[a(c,{modelValue:s.value.password,"onUpdate:modelValue":l[7]||(l[7]=e=>s.value.password=e),label:"Password",outlined:"",dense:"",type:"password"},null,8,["modelValue"])])),o("div",Ve,[a(c,{modelValue:s.value.mobile,"onUpdate:modelValue":l[8]||(l[8]=e=>s.value.mobile=e),label:"Mobile",outlined:"",dense:""},null,8,["modelValue"])]),o("div",xe,[a(V,{modelValue:s.value.district,"onUpdate:modelValue":l[9]||(l[9]=e=>s.value.district=e),options:N.value.map(e=>({label:e.name,value:e._id})),label:"District",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",we,[a(V,{modelValue:s.value.department,"onUpdate:modelValue":l[10]||(l[10]=e=>s.value.department=e),options:D.value.map(e=>({label:e.name,value:e._id})),label:"Department",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",Ue,[a(V,{modelValue:s.value.roles,"onUpdate:modelValue":l[11]||(l[11]=e=>s.value.roles=e),options:P.map(e=>({label:e.label,value:e.value})),label:"Role",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",he,[a(c,{modelValue:s.value.designation,"onUpdate:modelValue":l[12]||(l[12]=e=>s.value.designation=e),label:"Designation",outlined:"",dense:""},null,8,["modelValue"])])]),o("div",qe,[W(a(x,{flat:"",label:"Cancel",color:"negative"},null,512),[[ee]]),a(x,{type:"submit",label:"Save",color:"primary",unelevated:""})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Te=ae(ke,[["__scopeId","data-v-9096dd19"]]);export{Te as default};
