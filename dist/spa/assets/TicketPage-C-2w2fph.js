import{J as U,k as n,m as L,n as r,s,p as t,a5 as S,$ as D,W as d,X as N,Y as P,Z as $,_ as v,a0 as i,q as u,a8 as g,ac as A,al as M,ai as Y,Q as y,a7 as R,ad as O,ag as k,a9 as p,r as m,f as z}from"./index-Bzn0LiPU.js";import{Q as j}from"./QBadge-CCt-JOPv.js";import{Q as E}from"./QPage-DWBr2NDD.js";import{C as J}from"./ClosePopup-C6H1DDOC.js";import{d as W}from"./date-wIcGPrjE.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./format-DyQxkAtJ.js";const Z={class:"row q-col-gutter-md"},G={class:"row items-center justify-between"},H={class:"text-subtitle1 text-weight-medium ellipsis-2-lines"},K={class:"text-caption text-grey q-mt-xs"},ee={key:0,class:"text-center q-mt-xl text-grey"},te={key:1,class:"text-center q-my-lg"},se={class:"text-body2 q-ml-sm"},ae={key:0},le={class:"text-caption text-grey"},oe={key:1,class:"text-grey q-mt-sm"},ie={class:"row q-mb-md"},re={class:"text-right q-mt-sm"},ne={__name:"TicketPage",setup(de){const b=m([]),f=m(!1),x=m(""),w=m(!1),o=m(null),_=m(!1),c=m(""),C=async()=>{f.value=!0;try{const l=await k.get("/admin-api/tickets?page=1&limit=50");b.value=l.data.tickets||[]}catch(l){console.error("Failed to fetch tickets:",l),p.create({type:"negative",message:"Failed to fetch tickets."})}finally{f.value=!1}},h=z(()=>{if(!x.value)return b.value;const l=x.value.toLowerCase();return b.value.filter(e=>e.subject.toLowerCase().includes(l)||e.status.toLowerCase().includes(l)||e.user?.email?.toLowerCase().includes(l))}),B=async l=>{try{const e=await k.get(`/admin-api/tickets/${l._id}`);o.value=e.data.ticket,w.value=!0}catch(e){p.create({type:"negative",message:"Failed to fetch ticket.",err:e})}},F=async()=>{if(!(!c.value.trim()||!o.value?._id)){_.value=!0;try{const l=await k.post(`/admin/tickets/${o.value._id}/replies`,{message:c.value});o.value=l.data.ticket,c.value="",p.create({type:"positive",message:"Reply sent successfully."}),C()}catch{p.create({type:"negative",message:"Failed to send reply."})}finally{_.value=!1}}},q=async l=>{if(o.value?._id)try{const e=await k.patch(`/admin/tickets/${o.value._id}/status`,{status:l});o.value=e.data.ticket,p.create({type:"positive",message:"Ticket status updated."}),C()}catch{p.create({type:"negative",message:"Failed to update status."})}},Q=l=>({Open:"orange","In Progress":"blue",Closed:"grey"})[l]||"blue",V=l=>W.formatDate(l,"DD MMM YYYY, hh:mm A"),I=()=>{o.value=null,c.value=""};return U(C),(l,e)=>(n(),L(E,{class:"q-pa-md"},{default:r(()=>[e[15]||(e[15]=s("div",{class:"row items-center justify-between q-mb-md"},[s("div",{class:"text-h5 text-weight-bold text-primary"},"All Support Tickets")],-1)),t(S,{dense:"",outlined:"",debounce:"300",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),placeholder:"Search by subject, user, or status...",class:"q-mb-lg"},{append:r(()=>[t(D,{name:"search"})]),_:1},8,["modelValue"]),s("div",Z,[(n(!0),d(N,null,P(h.value,a=>(n(),d("div",{key:a._id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[t($,{flat:"",bordered:"",class:"ticket-card cursor-pointer",onClick:T=>B(a)},{default:r(()=>[t(v,null,{default:r(()=>[s("div",G,[s("div",H,i(a.subject),1),t(j,{color:Q(a.status),class:"text-white"},{default:r(()=>[u(i(a.status),1)]),_:2},1032,["color"])]),s("div",K,i(a.user?.email||"Unknown user"),1)]),_:2},1024),t(g),t(v,{class:"text-grey-8 text-body2 ellipsis-3-lines"},{default:r(()=>[u(i(a.description||"No description provided."),1)]),_:2},1024),t(g),t(v,{class:"text-caption text-right text-grey"},{default:r(()=>[u(i(V(a.createdAt)),1)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]),!h.value.length&&!f.value?(n(),d("div",ee,[t(D,{name:"support_agent",size:"56px",color:"grey-5"}),e[6]||(e[6]=s("div",{class:"text-subtitle1 q-mt-sm"},"No tickets found",-1))])):A("",!0),f.value?(n(),d("div",te,[t(M,{color:"primary",size:"40px"})])):A("",!0),t(Y,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=a=>w.value=a),persistent:""},{default:r(()=>[t($,{style:{"max-width":"700px",width:"100%"}},{default:r(()=>[t(v,{class:"text-h6 text-primary"},{default:r(()=>[u(i(o.value?.subject),1)]),_:1}),t(g),t(v,null,{default:r(()=>[s("div",null,[e[7]||(e[7]=s("strong",null,"User:",-1)),u(" "+i(o.value?.user?.email||"Unknown"),1)]),s("div",null,[e[8]||(e[8]=s("strong",null,"Category:",-1)),u(" "+i(o.value?.category||"-"),1)]),s("div",null,[e[9]||(e[9]=s("strong",null,"Priority:",-1)),u(" "+i(o.value?.priority||"-"),1)]),s("div",null,[e[10]||(e[10]=s("strong",null,"Status:",-1)),t(j,{color:Q(o.value?.status),class:"text-white q-ml-xs"},{default:r(()=>[u(i(o.value?.status),1)]),_:1},8,["color"])]),e[11]||(e[11]=s("div",{class:"q-mt-sm"},[s("strong",null,"Description:")],-1)),s("div",se,i(o.value?.description),1),t(g,{class:"q-my-md"}),e[12]||(e[12]=s("div",{class:"text-subtitle2"},"Replies",-1)),o.value?.replies?.length?(n(),d("div",ae,[(n(!0),d(N,null,P(o.value.replies,(a,T)=>(n(),d("div",{key:T,class:"q-pa-sm bg-grey-2 q-mt-sm rounded-borders"},[s("div",le,i(a.user?.email||a.sender?.email||"Admin")+" â€¢ "+i(V(a.createdAt)),1),s("div",null,i(a.message),1)]))),128))])):(n(),d("div",oe,"No replies yet.")),t(g,{class:"q-my-md"}),e[13]||(e[13]=s("div",{class:"text-subtitle2 q-mb-sm"},"Change Status",-1)),s("div",ie,[t(y,{dense:"",color:"orange",label:"Open",onClick:e[1]||(e[1]=a=>q("Open")),class:"q-mr-sm"}),t(y,{dense:"",color:"blue",label:"In Progress",onClick:e[2]||(e[2]=a=>q("In Progress")),class:"q-mr-sm"}),t(y,{dense:"",color:"grey",label:"Closed",onClick:e[3]||(e[3]=a=>q("Closed"))})]),e[14]||(e[14]=s("div",{class:"text-subtitle2 q-mb-sm"},"Add Reply",-1)),t(S,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value=a),type:"textarea",outlined:"",placeholder:"Type your reply...",autogrow:"",dense:""},null,8,["modelValue"]),s("div",re,[t(y,{color:"primary",label:"Send",icon:"send",loading:_.value,disable:!c.value.trim(),onClick:F},null,8,["loading","disable"])])]),_:1}),t(R,{align:"right"},{default:r(()=>[O(t(y,{flat:"",label:"Close",color:"primary",onClick:I},null,512),[[J]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},fe=X(ne,[["__scopeId","data-v-63170951"]]);export{fe as default};
