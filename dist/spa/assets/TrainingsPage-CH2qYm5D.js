import{a as H,Q}from"./QTabs-A9KaiqoZ.js";import{y as Z,k as r,m as _,n as i,s,p as a,I as d,J as F,K as I,L as x,N as c,$ as T,O as o,q as g,M as f,Q as u,a6 as tt,a7 as L,a0 as P,W as et,X as st,a5 as at,a3 as p,r as m,f as lt}from"./index-05LJQMJY.js";import{Q as it}from"./QChip-CTRFJQAs.js";import{Q as ot}from"./QRating-Br1LIlOh.js";import{Q as M}from"./QImg-CLkUziEz.js";import{Q as nt}from"./QBadge-d-kw_bhD.js";import{Q as rt,a as D}from"./QItemSection-CaYh8A0-.js";import{Q as R}from"./QItemLabel-Bow0-YZv.js";import{Q as dt}from"./QList-B_jwLyLT.js";import{Q as ct}from"./QPage-Cy0K29gO.js";import{C as O}from"./ClosePopup-Duyg3pN8.js";import{u as ut}from"./use-quasar-DT7WokEl.js";import{_ as mt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QResizeObserver-DygHWplN.js";import"./rtl-DFPa-2ov.js";import"./format-DyQxkAtJ.js";const _t={class:"row q-col-gutter-md"},gt={key:0,class:"absolute-full flex flex-center bg-grey-4",style:{height:"180px"}},vt={class:"absolute-bottom bg-gradient-to-top text-white q-pa-md"},yt={class:"text-h6 q-mb-xs"},ft={class:"text-caption ellipsis"},pt={class:"row items-center q-mt-xs justify-between"},xt={class:"row items-center"},ht={class:"text-caption q-ml-xs"},bt={class:"row items-center justify-between q-mb-xs"},wt={class:"text-subtitle2 text-primary text-weight-medium"},qt={class:"text-grey-8 text-caption"},kt={class:"text-grey-8 text-caption"},Qt={class:"text-grey-8 text-caption"},Ct={class:"text-grey-8 text-caption q-mb-sm"},Et={class:"text-body2 text-grey-9 ellipsis-3-lines q-mb-md"},zt={class:"row items-center justify-between"},Vt={class:"row items-center"},Nt={key:1},Ft={key:2,class:"text-grey"},Tt={key:0,class:"text-center q-pa-xl text-grey-7"},Dt={class:"absolute-bottom bg-gradient-to-top from-black/60 text-white q-pa-md"},St={class:"text-h5 text-weight-bold ellipsis"},$t={key:1,class:"banner-fallback flex flex-center bg-grey-3"},At={class:"text-body1 q-mb-md"},Ut={class:"row q-col-gutter-md"},Bt={class:"col-12 col-sm-6"},It={class:"text-body1 text-weight-medium"},Lt={class:"col-12 col-sm-6"},Pt={class:"text-body1 text-weight-medium"},Mt={class:"col-12 col-sm-6"},Rt={class:"text-body1 text-weight-medium"},Ot={class:"col-12 col-sm-6"},Wt={class:"text-body1 text-weight-medium"},jt={class:"text-body1 text-weight-medium"},Gt={class:"text-caption text-grey"},Jt={class:"text-caption text-grey"},Kt={class:"text-h6 text-primary"},Xt={key:0,class:"text-center q-pa-md"},Yt={key:2,class:"text-grey text-center q-pa-md"},Ht={__name:"TrainingsPage",setup(Zt){const v=ut(),h=m("all"),C=m([]),b=m([]),E=m(!1),n=m(null),w=m([]),q=m(!1),z=m(!1),V=async()=>{try{const l=await p.get("/api/enrollments");b.value=l.data.enrollments||[]}catch(l){console.error("Failed to load enrollments:",l)}},S=async()=>{try{const t=(await p.get("/api/trainings")).data.programs||[];b.value.length||await V(),C.value=t.map(e=>{const y=b.value.filter(N=>N.training_program?._id===e._id).length,Y=b.value.some(N=>N.training_program?._id===e._id);return{...e,isEnrolled:Y,enrolledCount:y,remainingSeats:e.t_capacity===-1?1/0:e.t_capacity-y}})}catch(l){console.error("Failed to load programs:",l)}},$=lt(()=>h.value==="all"?C.value:C.value.filter(l=>l.t_status===h.value)),A=l=>l?l.startsWith("http://")||l.startsWith("https://")?l:l.startsWith("/")?`${p.defaults.baseURL}${l}`:`${p.defaults.baseURL}/${l}`:"",k=l=>new Date(l).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}),U=l=>({Upcoming:"blue",Ongoing:"green",Finished:"grey"})[l]||"primary",W=l=>l.t_status==="Finished"?"View Summary":l.isEnrolled?"Enrolled":l.remainingSeats<=0?"Full":"Enroll Now",j=l=>l.t_status==="Finished"?"grey":l.isEnrolled?"positive":l.remainingSeats<=0?"negative":"primary",B=async l=>{if(l.t_status!=="Finished"){if(l.isEnrolled){v.notify({type:"info",message:"You are already enrolled!"});return}if(l.remainingSeats<=0){v.notify({type:"negative",message:"This training is full!"});return}v.dialog({title:"Enroll in Training",message:`Do you want to enroll for "${l.t_name}"?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await p.post(`/api/training/${l._id}/enrollments`),v.notify({type:"positive",message:"Successfully enrolled!"}),await V(),await S()}catch(t){v.notify({type:"negative",message:"Enrollment failed.",error:t})}})}},G=async l=>{n.value=l,E.value=!0},J=l=>l?l.startsWith("http")?l:`https://staging2.egovmz.in${l.replace(/^.*\/uploads/,"/uploads")}`:"#",K=async l=>{w.value=[],z.value=!0;try{const{data:t}=await p.get(`/api/enrollment/${l}/material`);w.value=t.materials||[]}catch(t){console.error("Failed to fetch materials:",t),v.notify({type:"negative",message:"Unable to load materials"})}finally{z.value=!1}},X=async()=>{n.value?._id&&(q.value=!0,await K(n.value._id))};return Z(async()=>{await V(),await S()}),(l,t)=>(r(),_(ct,{class:"q-pa-md bg-grey-1"},{default:i(()=>[t[18]||(t[18]=s("div",{class:"text-h5 text-weight-bold q-mb-lg"},"Available Trainings",-1)),a(H,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),dense:"",class:"text-primary q-mb-md",align:"left","active-color":"primary","indicator-color":"primary"},{default:i(()=>[a(Q,{name:"all",label:"All"}),a(Q,{name:"Upcoming",label:"Upcoming"}),a(Q,{name:"Ongoing",label:"Ongoing"}),a(Q,{name:"Finished",label:"Finished"})]),_:1},8,["modelValue"]),s("div",_t,[(r(!0),d(F,null,I($.value,e=>(r(),d("div",{key:e._id,class:"col-12 col-md-6 col-lg-4"},[a(x,{flat:"",bordered:"",class:"cursor-pointer hover-scale",onClick:y=>G(e)},{default:i(()=>[a(M,{src:A(e.t_banner),ratio:16/9,alt:"Training Banner"},{default:i(()=>[e.t_banner?T("",!0):(r(),d("div",gt,[a(c,{name:"image",size:"48px",color:"grey-6"}),t[5]||(t[5]=s("div",{class:"text-grey-6 q-mt-md"},"No Banner Available",-1))])),s("div",vt,[s("div",yt,o(e.t_name),1),s("div",ft,o(e.t_description),1),s("div",pt,[a(it,{dense:"",color:U(e.t_status),"text-color":"white"},{default:i(()=>[g(o(e.t_status),1)]),_:2},1032,["color"]),s("div",xt,[a(ot,{modelValue:e.averageRating,"onUpdate:modelValue":y=>e.averageRating=y,max:"5",color:"yellow",readonly:"",size:"18px"},null,8,["modelValue","onUpdate:modelValue"]),s("div",ht,"("+o(e.ratingsCount)+")",1)])])])]),_:2},1032,["src"]),a(f,{class:"q-pt-sm"},{default:i(()=>[s("div",bt,[s("div",wt,o(e.t_category?.name||"General"),1),a(nt,{color:U(e.t_status),label:e.t_status,class:"text-uppercase"},null,8,["color","label"])]),s("div",qt,[a(c,{name:"event",size:"16px",class:"q-mr-xs"}),g(" "+o(k(e.t_start_date))+" → "+o(k(e.t_end_date)),1)]),s("div",kt,[a(c,{name:"hourglass_bottom",size:"16px",class:"q-mr-xs"}),g(" Duration: "+o(e.t_duration)+" days ",1)]),s("div",Qt,[a(c,{name:"badge",size:"16px",class:"q-mr-xs"}),t[6]||(t[6]=g(" Eligibility: ",-1)),s("strong",null,o(e.t_eligibility||"All Employees"),1)]),s("div",Ct,[a(c,{name:"account_balance",size:"16px",class:"q-mr-xs"}),t[7]||(t[7]=g(" Organizer: ",-1)),s("strong",null,o(e.t_organizer||"ATI"),1)]),s("div",Et,o(e.t_description),1),s("div",zt,[s("div",Vt,[e.averageRating>0?(r(),_(c,{key:0,name:"star",color:"amber",size:"18px",class:"q-mr-xs"})):T("",!0),e.averageRating>0?(r(),d("span",Nt,o(e.averageRating.toFixed(1)),1)):(r(),d("span",Ft,"No ratings yet"))]),a(u,{label:W(e),color:j(e),disable:e.isEnrolled||e.t_status==="Finished",onClick:tt(y=>B(e),["stop"]),rounded:"",size:"sm",unelevated:""},null,8,["label","color","disable","onClick"])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]),$.value.length===0?(r(),d("div",Tt,[a(c,{name:"school",size:"64px",color:"grey-5"}),t[8]||(t[8]=s("div",{class:"text-h6 q-mt-md"},"No trainings found for this status",-1))])):T("",!0),a(L,{modelValue:E.value,"onUpdate:modelValue":t[4]||(t[4]=e=>E.value=e),style:{"min-width":"750px"}},{default:i(()=>[a(x,{class:"q-relative enrollment-dialog-card"},{default:i(()=>[n.value?.t_banner?(r(),_(M,{key:0,src:A(n.value.t_banner),class:"banner-image",alt:"Training Banner"},{default:i(()=>[s("div",Dt,[s("div",St,o(n.value.t_name),1),t[9]||(t[9]=s("div",{class:"text-subtitle2 ellipsis"},"Training Details",-1))])]),_:1},8,["src"])):(r(),d("div",$t,[a(c,{name:"image",size:"64px",color:"grey-5"}),t[10]||(t[10]=s("div",{class:"text-h6 text-grey-6 q-ml-md"},"No Banner Available",-1))])),P(a(u,{flat:"",round:"",icon:"close",class:"absolute-top-right text-white"},null,512),[[O]]),a(f,{class:"scroll q-pa-md",style:{"max-height":"75vh","overflow-y":"auto"}},{default:i(()=>[a(x,{flat:"",bordered:"",class:"q-mb-md shadow-1"},{default:i(()=>[a(f,null,{default:i(()=>[t[15]||(t[15]=s("div",{class:"text-h6 text-primary text-weight-bold q-mb-sm"},"Program Overview",-1)),s("div",At,o(n.value.t_description||"No description available."),1),s("div",Ut,[s("div",Bt,[t[11]||(t[11]=s("div",{class:"text-caption text-grey"},"Category",-1)),s("div",It,o(n.value.t_category?.name||"General"),1)]),s("div",Lt,[t[12]||(t[12]=s("div",{class:"text-caption text-grey"},"Organizer",-1)),s("div",Pt,o(n.value.t_organizer||"ATI"),1)]),s("div",Mt,[t[13]||(t[13]=s("div",{class:"text-caption text-grey"},"Start Date",-1)),s("div",Rt,o(k(n.value.t_start_date)),1)]),s("div",Ot,[t[14]||(t[14]=s("div",{class:"text-caption text-grey"},"End Date",-1)),s("div",Wt,o(k(n.value.t_end_date)),1)])])]),_:1})]),_:1}),a(x,{flat:"",bordered:"",class:"q-mb-md shadow-1"},{default:i(()=>[a(f,null,{default:i(()=>[t[16]||(t[16]=s("div",{class:"text-h6 text-primary text-weight-bold q-mb-sm"},"Training Location",-1)),s("div",null,[a(c,{name:"location_on",size:"18px",class:"q-mr-xs text-primary"}),s("span",jt,o(n.value.t_room?.room_name||"Not Assigned"),1),s("div",Gt,"Room No: "+o(n.value.t_room?.room_no||"N/A"),1),s("div",Jt,"Capacity: "+o(n.value.t_room?.capacity||"N/A")+" people ",1)])]),_:1})]),_:1})]),_:1}),a(et,{align:"right",class:"q-pa-md"},{default:i(()=>[P(a(u,{flat:"",label:"Close",color:"grey"},null,512),[[O]]),!n.value.isEnrolled&&n.value.t_status!=="Finished"?(r(),_(u,{key:0,label:"Enroll Now",color:"primary",onClick:t[1]||(t[1]=e=>B(n.value))})):n.value.isEnrolled?(r(),d(F,{key:1},[a(u,{label:"Already Enrolled",color:"positive",disable:""}),a(u,{color:"secondary",label:"View Study Materials",icon:"school",onClick:X})],64)):(r(),_(u,{key:2,label:"Training Finished",color:"grey",disable:""}))]),_:1})]),_:1}),a(L,{modelValue:q.value,"onUpdate:modelValue":t[3]||(t[3]=e=>q.value=e),persistent:""},{default:i(()=>[a(x,{class:"q-pa-md",style:{"min-width":"500px","max-width":"800px"}},{default:i(()=>[a(f,{class:"row items-center justify-between"},{default:i(()=>[s("div",Kt," Study Materials – "+o(n.value.t_name),1),a(u,{flat:"",dense:"",icon:"close",color:"negative",onClick:t[2]||(t[2]=e=>q.value=!1)})]),_:1}),a(st),a(f,null,{default:i(()=>[z.value?(r(),d("div",Xt,[a(at,{color:"primary",size:"2em"}),t[17]||(t[17]=s("div",{class:"text-caption q-mt-sm"},"Loading materials...",-1))])):w.value.length?(r(),_(dt,{key:1,bordered:"",separator:""},{default:i(()=>[(r(!0),d(F,null,I(w.value,e=>(r(),_(rt,{key:e._id,clickable:"",tag:"a",href:J(e.file_url),target:"_blank"},{default:i(()=>[a(D,{avatar:""},{default:i(()=>[a(c,{name:"description",color:"primary"})]),_:1}),a(D,null,{default:i(()=>[a(R,null,{default:i(()=>[g(o(e.file_name),1)]),_:2},1024),a(R,{caption:""},{default:i(()=>[g(o(e.mime_type),1)]),_:2},1024)]),_:2},1024),a(D,{side:""},{default:i(()=>[a(c,{name:"open_in_new"})]),_:1})]),_:2},1032,["href"]))),128))]),_:1})):(r(),d("div",Yt," No study materials found for this training. "))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}))}},ye=mt(Ht,[["__scopeId","data-v-56b4495e"]]);export{ye as default};
