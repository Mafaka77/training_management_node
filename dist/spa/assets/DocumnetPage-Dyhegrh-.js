import{a as G,v as H,g as Y,d as Z,u as ee,f as P,A as te,y as le,k as i,m as C,n as s,s as n,p as t,U as q,N as w,Q as d,I as p,J as ae,K as se,L as $,M as D,O as b,X as j,W as oe,a6 as k,$ as z,a7 as L,a0 as T,r,a3 as U}from"./index-05LJQMJY.js";import{Q as M}from"./QImg-CLkUziEz.js";import{Q as ne}from"./QPagination-C4SH1HCP.js";import{Q as ie}from"./QFile-ezqVRJjF.js";import{Q as re}from"./QForm-BKdLbmwT.js";import{Q as ue}from"./QSpace-9lVGGo-r.js";import{Q as de}from"./QPage-Cy0K29gO.js";import{C as O}from"./ClosePopup-Duyg3pN8.js";import{u as ce}from"./use-quasar-DT7WokEl.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./format-DyQxkAtJ.js";import"./QChip-CTRFJQAs.js";import"./use-file-BJTEmDmu.js";const pe=G({name:"QBar",props:{...H,dense:Boolean},setup(Q,{slots:u}){const{proxy:{$q:v}}=Y(),c=te(Q,v),g=P(()=>`q-bar row no-wrap items-center q-bar--${Q.dense===!0?"dense":"standard"}  q-bar--${c.value===!0?"dark":"light"}`);return()=>Z("div",{class:g.value,role:"toolbar"},ee(u.default))}}),ve={class:"row items-center justify-between q-mb-md"},fe={class:"row items-center q-gutter-sm"},ge={class:"row q-col-gutter-md"},ye={key:1,class:"pdf-thumb flex flex-center bg-grey-2",style:{height:"180px"}},_e={class:"text-subtitle1 ellipsis"},he={class:"text-caption text-grey-7 ellipsis"},xe={class:"text-caption text-grey q-mt-xs"},we={key:0,class:"col-12 text-center q-mt-xl"},be={key:0,class:"q-pa-md flex flex-center"},De={class:"text-h6"},ke={class:"row justify-end q-gutter-sm"},Qe={class:"text-h6"},Ve=["src"],Ce={key:2,class:"text-center q-pa-xl text-grey"},W=8,qe={__name:"DocumnetPage",setup(Q){const u=ce(),v=r([]),c=r(""),g=r(1),F=r(0),y=r(!1),S=r(!1),f=r(null),m=r(null),o=r({title:"",description:"",file:null}),V=r(!1),B=P(()=>Math.ceil(F.value/W)),I=P(()=>c.value?v.value.filter(e=>e.title.toLowerCase().includes(c.value.toLowerCase())):v.value),_=e=>e?e.startsWith("http")?e:`https://staging2.egovmz.in${e}`:"";console.log("Preview URL:",_(v.value[0]?.fileUrl));const A=e=>/(jpg|jpeg|png|gif)$/i.test(e),h=async()=>{try{const e=await U.get(`/api/documents?page=${g.value}&limit=${W}&search=${c.value}`);v.value=e.data.documents||[],F.value=e.data.pagination?.total||0,console.log("Fetched documents:",e.data.documents)}catch(e){console.error(e),u.notify({type:"negative",message:"Failed to fetch documents"})}},E=()=>{f.value=null,o.value={title:"",description:"",file:null},y.value=!0},R=e=>{f.value=e,o.value={title:e.title,description:e.description,file:null},y.value=!0},J=async()=>{V.value=!0;const e=new FormData;e.append("title",o.value.title),e.append("description",o.value.description),o.value.file&&e.append("documents",o.value.file);try{const l=f.value?`/admin/api/document/${f.value._id}`:"/admin/api/documents",a=f.value?"put":"post",x=await U[a](l,e,{headers:{"Content-Type":"multipart/form-data"}});u.notify({type:"positive",message:"âœ… Document saved successfully",res:x}),y.value=!1,h()}catch(l){console.error(l),u.notify({type:"negative",message:"âŒ Failed to upload document"})}finally{V.value=!1}},K=e=>{u.dialog({title:"Confirm Delete",message:"Are you sure you want to delete this document?",cancel:!0,persistent:!0}).onOk(()=>X(e))},X=async e=>{try{await U.delete(`/admin/api/document/${e}`),u.notify({type:"positive",message:"Document deleted"}),h()}catch(l){console.error(l),u.notify({type:"negative",message:"Failed to delete"})}},N=e=>{if(!e)return;const l=e.startsWith("http")?e:`https://staging2.egovmz.in${e}`;window.open(l,"_blank")};return le(h),(e,l)=>(i(),C(de,{class:"q-pa-md"},{default:s(()=>[n("div",ve,[l[7]||(l[7]=n("div",{class:"text-h6 text-primary"},"ðŸ“‚ Document Management",-1)),n("div",fe,[t(q,{modelValue:c.value,"onUpdate:modelValue":[l[0]||(l[0]=a=>c.value=a),h],outlined:"",dense:"",debounce:"400",placeholder:"Search documents..."},{append:s(()=>[t(w,{name:"search"})]),_:1},8,["modelValue"]),t(d,{color:"primary",icon:"add",label:"Add Document",unelevated:"",onClick:E})])]),n("div",ge,[(i(!0),p(ae,null,se(I.value,a=>(i(),p("div",{key:a._id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[t($,{class:"shadow-2 hover:shadow-4 transition-all cursor-pointer",onClick:x=>N(a.fileUrl)},{default:s(()=>[A(a.fileType)?(i(),C(M,{key:0,src:_(a.fileUrl),ratio:"1","spinner-color":"primary",class:"rounded-t-borders"},null,8,["src"])):(i(),p("div",ye,[t(w,{name:"picture_as_pdf",color:"red",size:"64px"})])),t(D,null,{default:s(()=>[n("div",_e,b(a.title),1),n("div",he,b(a.description),1),n("div",xe," ðŸ•’ "+b(new Date(a.createdAt).toLocaleDateString()),1)]),_:2},1024),t(j),t(oe,{align:"right"},{default:s(()=>[t(d,{flat:"",dense:"",icon:"visibility",color:"primary",onClick:k(x=>N(a.fileUrl),["stop"])},null,8,["onClick"]),t(d,{flat:"",dense:"",icon:"edit",color:"blue",onClick:k(x=>R(a),["stop"])},null,8,["onClick"]),t(d,{flat:"",dense:"",icon:"delete",color:"negative",onClick:k(x=>K(a._id),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128)),I.value.length?z("",!0):(i(),p("div",we,[t(w,{name:"inbox",size:"64px",color:"grey-5"}),l[8]||(l[8]=n("div",{class:"text-grey q-mt-sm"},"No documents found",-1))]))]),B.value>1?(i(),p("div",be,[t(ne,{modelValue:g.value,"onUpdate:modelValue":[l[1]||(l[1]=a=>g.value=a),h],max:B.value,color:"primary","direction-links":""},null,8,["modelValue","max"])])):z("",!0),t(L,{modelValue:y.value,"onUpdate:modelValue":l[5]||(l[5]=a=>y.value=a),persistent:""},{default:s(()=>[t($,{style:{"min-width":"400px"}},{default:s(()=>[t(D,null,{default:s(()=>[n("div",De,b(f.value?"Edit Document":"Add New Document"),1)]),_:1}),t(j),t(D,null,{default:s(()=>[t(re,{onSubmit:k(J,["prevent"]),class:"q-gutter-md"},{default:s(()=>[t(q,{modelValue:o.value.title,"onUpdate:modelValue":l[2]||(l[2]=a=>o.value.title=a),label:"Document Title",outlined:"",dense:"",rules:[a=>!!a||"Required"]},null,8,["modelValue","rules"]),t(q,{modelValue:o.value.description,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.description=a),label:"Description",outlined:"",dense:"",type:"textarea"},null,8,["modelValue"]),t(ie,{modelValue:o.value.file,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.file=a),label:"Select Document",outlined:"",dense:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png","use-chips":"",counter:""},{prepend:s(()=>[t(w,{name:"attach_file"})]),_:1},8,["modelValue"]),n("div",ke,[T(t(d,{flat:"",label:"Cancel",color:"grey"},null,512),[[O]]),t(d,{label:"Save",color:"primary",type:"submit",loading:V.value},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:S.value,"onUpdate:modelValue":l[6]||(l[6]=a=>S.value=a),maximized:""},{default:s(()=>[t($,{class:"bg-white"},{default:s(()=>[t(pe,null,{default:s(()=>[n("div",Qe,b(m.value?.title),1),t(ue),T(t(d,{dense:"",flat:"",icon:"close"},null,512),[[O]])]),_:1}),t(D,{class:"q-pa-none"},{default:s(()=>[m.value&&m.value.fileType.includes("pdf")?(i(),p("iframe",{key:0,src:_(m.value.fileUrl),width:"100%",height:"90vh",frameborder:"0"},null,8,Ve)):A(m.value?.fileType)?(i(),C(M,{key:1,src:_(m.value.fileUrl),fit:"contain",class:"bg-grey-2",style:{height:"90vh"}},null,8,["src"])):(i(),p("div",Ce,[t(w,{name:"insert_drive_file",size:"64px"}),l[9]||(l[9]=n("div",{class:"q-mt-sm"},"Preview not available for this file type",-1)),t(d,{color:"primary",flat:"",label:"Open File",class:"q-mt-md",href:_(m.value.fileUrl),target:"_blank"},null,8,["href"])]))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Me=me(qe,[["__scopeId","data-v-7857b17d"]]);export{Me as default};
