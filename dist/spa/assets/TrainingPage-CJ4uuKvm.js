import{Q as C,a as pe}from"./QTabs-gCNjH1lx.js";import{a2 as ge,J as ve,k as q,W as Q,p as l,n as r,s as n,$ as f,a5 as u,Q as m,q as D,a0 as d,ac as B,Z as Y,_ as U,ad as L,ai as Z,a8 as fe,aj as _e,ag as v,r as i,f as H}from"./index-Bzn0LiPU.js";import{Q as F}from"./QSelect-ChM7-dt3.js";import{Q as M}from"./QSpace-BcajTR04.js";import{Q as I}from"./QImg-B-Xiv_j_.js";import{Q as _}from"./QTd-Bjv19h1_.js";import{Q as ye}from"./QChip-COUtrNlO.js";import{Q as be}from"./QRating-B5vDZbVV.js";import{Q as E}from"./QTooltip-bg_yg9Hm.js";import{Q as we}from"./QTable-C7Me2Ftf.js";import{Q as xe}from"./QFile-CjdTDf9_.js";import{Q as Ve}from"./QForm-FpFFQh9P.js";import{C as j}from"./ClosePopup-C6H1DDOC.js";import{u as Pe}from"./use-quasar-CLO-DOJZ.js";import"./QResizeObserver-DM40u9wL.js";import"./rtl-DFPa-2ov.js";import"./QItemSection-COOhA9zR.js";import"./QItemLabel-BQHMT6Ru.js";import"./QMenu-2e4m313B.js";import"./position-engine-BCFNfW53.js";import"./selection-DFkNIa7B.js";import"./format-DyQxkAtJ.js";import"./QList-BSRIgFgv.js";import"./QLinearProgress-DAd5lNjJ.js";import"./use-fullscreen-2nc3m1XY.js";import"./use-file-C-vdhq8C.js";const he={class:"q-pa-md"},Ce={class:"row q-col-gutter-md q-mb-md items-center"},qe={class:"col-12 col-md-4"},Qe={class:"col-12 col-md-2"},De={class:"col-12 col-md-2"},Ue={class:"col-12 col-md-4 text-right"},Fe={class:"text-caption text-grey"},Ne={class:"row items-center no-wrap"},Te={class:"q-mr-sm",style:{width:"60px",height:"40px"}},Re={key:0,class:"absolute-full flex flex-center bg-grey-3"},$e={class:"text-weight-medium"},Se={class:"text-caption text-grey-7 ellipsis",style:{"max-width":"200px"}},ze={class:"text-caption text-grey-7"},Ae={class:"row items-center"},Oe={class:"row items-center"},ke={class:"q-ml-xs text-caption"},Be={class:"row no-wrap q-gutter-xs"},Le={class:"full-width row flex-center text-grey q-gutter-sm q-py-lg"},Me={class:"text-h6"},Ie={key:0,class:"absolute-full flex flex-center bg-grey-3"},Ee={class:"text-h6 text-primary"},je={class:"row q-col-gutter-md"},Ge={class:"col-12 col-md-6"},We={class:"row q-col-gutter-sm"},Je={class:"col-6"},Ye={class:"col-6"},Ze={class:"col-12 col-md-6"},He={key:0,class:"q-mt-sm"},Ke={class:"row justify-end q-gutter-sm q-mt-lg"},Qt={__name:"TrainingPage",setup(Xe){const K=ge(),c=Pe(),b=i([]),N=i(!1),w=i("all"),y=i(!1),T=i(!1),p=i(!1),R=i(!1),x=i(null),V=i(""),P=i(null),h=i(null),g=i({page:1,rowsPerPage:10,rowsNumber:0}),o=i({t_name:"",t_description:"",t_start_date:"",t_end_date:"",t_duration:0,t_eligibility:"",t_organizer:"",t_capacity:null,t_room:null,t_category:null,t_banner:null}),$=i([]),S=i([]),X=[{name:"name",required:!0,label:"PROGRAM",align:"left",field:a=>a.t_name,sortable:!0},{name:"status",label:"STATUS",align:"center",field:a=>a.t_status,sortable:!0},{name:"dates",label:"DATES",align:"center",field:a=>a.t_start_date,sortable:!0,sort:(a,t)=>new Date(a)-new Date(t)},{name:"duration",label:"DURATION",align:"center",field:a=>`${a.t_duration} days`,sortable:!0},{name:"category",label:"CATEGORY",align:"center",field:a=>a.t_category?.name,sortable:!0},{name:"room",label:"ROOM",align:"center",field:a=>a.t_room?.room_name,sortable:!0},{name:"capacity",label:"CAPACITY",align:"center",field:a=>a.t_capacity,sortable:!0},{name:"rating",label:"RATING",align:"center",field:a=>a.averageRating,sortable:!0},{name:"actions",label:"ACTIONS",align:"center",sortable:!1}],z=H(()=>{let a=b.value;if(w.value!=="all"&&(a=a.filter(t=>t.t_status===w.value)),P.value&&(a=a.filter(t=>t.t_category?._id===P.value)),h.value&&(a=a.filter(t=>t.t_room?._id===h.value)),V.value){const t=V.value.toLowerCase();a=a.filter(e=>e.t_name.toLowerCase().includes(t)||e.t_description&&e.t_description.toLowerCase().includes(t)||e.t_organizer&&e.t_organizer.toLowerCase().includes(t)||e.t_category?.name&&e.t_category.name.toLowerCase().includes(t))}return a}),ee=H(()=>{const a=(g.value.page-1)*g.value.rowsPerPage,t=a+g.value.rowsPerPage;return z.value.slice(a,t)}),A=a=>a?a.startsWith("http://")||a.startsWith("https://")?a:a.startsWith("/")?`${v.defaults.baseURL}${a}`:`${v.defaults.baseURL}/uploads/${a}`:"",te=a=>a instanceof File?URL.createObjectURL(a):A(a),G=a=>{if(!a)return"N/A";const t=new Date(a);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},ae=a=>({Upcoming:"secondary",Ongoing:"orange",Finished:"green"})[a]||"grey",le=a=>{c.notify({type:"negative",message:`File rejected: ${a[0]?.failedPropValidation||"Invalid file"}`})};function oe(a){const{page:t,rowsPerPage:e}=a.pagination;g.value.page=t,g.value.rowsPerPage=e,g.value.rowsNumber=z.value.length}async function O(){N.value=!0;try{const a=await v.get("/admin-api/get-all-training-program?page=1&limit=100");b.value=a.data.programs||[],g.value.rowsNumber=b.value.length}catch(a){console.error("Failed to fetch programs:",a),c.notify({type:"negative",message:"Failed to load programs"})}finally{N.value=!1}}async function re(){try{const[a,t]=await Promise.all([v.get("/admin-api/get-training-room"),v.get("/admin-api/get-training-category")]);$.value=(a.data.rooms||[]).map(e=>({label:e.room_name,value:e._id})),S.value=(t.data.categories||[]).map(e=>({label:e.name,value:e._id}))}catch(a){console.error("Failed to fetch dropdowns:",a),c.notify({type:"negative",message:"Failed to load dropdown options"})}}async function ne(){R.value=!0;try{const a=new FormData;Object.keys(o.value).forEach(s=>{o.value[s]!==null&&o.value[s]!==void 0&&(s==="t_banner"&&o.value[s]instanceof File?a.append("t_banner",o.value[s]):a.append(s,o.value[s]))});const t=p.value?`/admin-api/update-training-program/${o.value._id}`:"/admin-api/submit-training-program",e=p.value?"put":"post";await v[e](t,a,{headers:{"Content-Type":"multipart/form-data"}}),c.notify({type:"positive",message:p.value?"Program updated successfully":"Program created successfully"}),y.value=!1,J(),await O()}catch(a){console.error("Failed to submit program:",a),c.notify({type:"negative",message:a.response?.data?.message||`Failed to ${p.value?"update":"create"} program`})}finally{R.value=!1}}async function ie(a){try{await v.delete(`/admin-api/admin-api/program/${a}`),c.notify({type:"positive",message:"Program deleted successfully"}),await O()}catch(t){console.error("Failed to delete program:",t),c.notify({type:"negative",message:t.response?.data?.message||"Failed to delete program"})}}function W(){p.value=!1,J(),y.value=!0}function se(a){p.value=!0,o.value={...a},k(),y.value=!0}function J(){o.value={t_name:"",t_description:"",t_start_date:"",t_end_date:"",t_duration:0,t_eligibility:"",t_organizer:"",t_capacity:null,t_room:null,t_category:null,t_banner:null}}function de(a){K.push(`/admin/training/${a._id}`)}function ue(a){x.value=a,T.value=!0}function me(a){c.dialog({title:"Confirm Delete",message:`Are you sure you want to delete "${a.t_name}"?`,cancel:!0,persistent:!0}).onOk(()=>{ie(a._id)})}const k=()=>{const{t_start_date:a,t_end_date:t}=o.value;if(a&&t)try{const e=new Date(a),s=new Date(t);if(isNaN(e.getTime())||isNaN(s.getTime())){o.value.t_duration=0;return}const ce=(s-e)/(1e3*60*60*24);o.value.t_duration=Math.max(0,Math.ceil(ce))}catch(e){console.error("Error calculating duration:",e),o.value.t_duration=0}else o.value.t_duration=0};return ve(async()=>{await Promise.all([O(),re()])}),(a,t)=>(q(),Q("div",he,[l(pe,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),dense:"",class:"text-primary q-mb-md",align:"left","active-color":"primary","indicator-color":"primary"},{default:r(()=>[l(C,{name:"all",label:"All"}),l(C,{name:"Upcoming",label:"Upcoming"}),l(C,{name:"Ongoing",label:"Ongoing"}),l(C,{name:"Finished",label:"Finished"})]),_:1},8,["modelValue"]),n("div",Ce,[n("div",qe,[l(u,{dense:"",debounce:"300",modelValue:V.value,"onUpdate:modelValue":[t[1]||(t[1]=e=>V.value=e),t[2]||(t[2]=e=>a.currentPage=1)],placeholder:"Search programs...",outlined:"",clearable:""},{append:r(()=>[l(f,{name:"search"})]),_:1},8,["modelValue"])]),n("div",Qe,[l(F,{dense:"",modelValue:P.value,"onUpdate:modelValue":[t[3]||(t[3]=e=>P.value=e),t[4]||(t[4]=e=>a.currentPage=1)],options:S.value.map(e=>({label:e.label,value:e.value})),label:"Category",outlined:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),n("div",De,[l(F,{dense:"",modelValue:h.value,"onUpdate:modelValue":[t[5]||(t[5]=e=>h.value=e),t[6]||(t[6]=e=>a.currentPage=1)],options:$.value.map(e=>({label:e.label,value:e.value})),label:"Room",outlined:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),n("div",Ue,[l(m,{icon:"add",color:"primary",label:"Add Program",onClick:W})])]),l(we,{flat:"",bordered:"",rows:ee.value,columns:X,"row-key":"_id",loading:N.value,pagination:g.value,onRequest:oe,class:"sticky-header-table"},{top:r(()=>[t[20]||(t[20]=n("div",{class:"text-h6"},"Training Programs",-1)),l(M),n("div",Fe," Showing "+d(z.value.length)+" of "+d(b.value.length)+" programs ",1)]),"body-cell-name":r(e=>[l(_,{props:e},{default:r(()=>[n("div",Ne,[n("div",Te,[l(I,{src:A(e.row.t_banner),style:{width:"60px",height:"40px","border-radius":"4px"},class:"cursor-pointer",onClick:s=>ue(e.row)},{default:r(()=>[e.row.t_banner?B("",!0):(q(),Q("div",Re,[l(f,{name:"image",size:"20px",color:"grey-6"})]))]),_:2},1032,["src","onClick"])]),n("div",null,[n("div",$e,d(e.row.t_name),1),n("div",Se,d(e.row.t_description||"No description"),1)])])]),_:2},1032,["props"])]),"body-cell-status":r(e=>[l(_,{props:e},{default:r(()=>[l(ye,{dense:"",color:ae(e.row.t_status),"text-color":"white",size:"sm"},{default:r(()=>[D(d(e.row.t_status),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-dates":r(e=>[l(_,{props:e},{default:r(()=>[n("div",null,d(G(e.row.t_start_date)),1),n("div",ze,"to "+d(G(e.row.t_end_date)),1)]),_:2},1032,["props"])]),"body-cell-capacity":r(e=>[l(_,{props:e},{default:r(()=>[n("div",Ae,[l(f,{name:"people",size:"16px",class:"q-mr-xs"}),n("span",null,d(e.row.t_capacity>0?e.row.t_capacity:"Unlimited"),1)])]),_:2},1032,["props"])]),"body-cell-rating":r(e=>[l(_,{props:e},{default:r(()=>[n("div",Oe,[l(be,{"model-value":e.row.averageRating||0,max:"5",color:"yellow",readonly:"",size:"16px"},null,8,["model-value"]),n("span",ke,"("+d(e.row.ratingsCount||0)+")",1)])]),_:2},1032,["props"])]),"body-cell-actions":r(e=>[l(_,{props:e},{default:r(()=>[n("div",Be,[l(m,{dense:"",flat:"",color:"primary",icon:"visibility",size:"sm",onClick:s=>de(e.row)},{default:r(()=>[l(E,null,{default:r(()=>[...t[21]||(t[21]=[D("View Details",-1)])]),_:1})]),_:1},8,["onClick"]),l(m,{dense:"",flat:"",color:"secondary",icon:"edit",size:"sm",onClick:s=>se(e.row)},{default:r(()=>[l(E,null,{default:r(()=>[...t[22]||(t[22]=[D("Edit",-1)])]),_:1})]),_:1},8,["onClick"]),l(m,{dense:"",flat:"",color:"negative",icon:"delete",size:"sm",onClick:s=>me(e.row)},{default:r(()=>[l(E,null,{default:r(()=>[...t[23]||(t[23]=[D("Delete",-1)])]),_:1})]),_:1},8,["onClick"])])]),_:2},1032,["props"])]),"no-data":r(()=>[n("div",Le,[l(f,{name:"info",size:"2em"}),t[24]||(t[24]=n("span",null,"No programs found",-1)),l(m,{flat:"",label:"Create First Program",color:"primary",onClick:W})])]),_:1},8,["rows","loading","pagination"]),l(Z,{modelValue:T.value,"onUpdate:modelValue":t[7]||(t[7]=e=>T.value=e)},{default:r(()=>[l(Y,null,{default:r(()=>[l(U,{class:"row items-center q-pb-none"},{default:r(()=>[n("div",Me,d(x.value?.t_name)+" - Banner",1),l(M),L(l(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1}),l(U,{class:"q-pt-none"},{default:r(()=>[l(I,{src:A(x.value?.t_banner),style:{"max-width":"600px","max-height":"400px"},class:"rounded-borders"},{default:r(()=>[x.value?.t_banner?B("",!0):(q(),Q("div",Ie,[l(f,{name:"image",size:"48px",color:"grey-6"}),t[25]||(t[25]=n("div",{class:"text-grey-6 q-mt-md"},"No Banner Available",-1))]))]),_:1},8,["src"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Z,{modelValue:y.value,"onUpdate:modelValue":t[19]||(t[19]=e=>y.value=e),persistent:""},{default:r(()=>[l(Y,{style:{"min-width":"600px","max-width":"800px"},class:"q-pa-md"},{default:r(()=>[l(U,{class:"row items-center q-pb-none"},{default:r(()=>[n("div",Ee,d(p.value?"Edit":"Add")+" Training Program",1),l(M),L(l(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1}),l(fe),l(U,{style:{"max-height":"70vh"},class:"scroll"},{default:r(()=>[l(Ve,{onSubmit:_e(ne,["prevent"]),class:"q-gutter-md"},{default:r(()=>[n("div",je,[n("div",Ge,[l(u,{modelValue:o.value.t_name,"onUpdate:modelValue":t[8]||(t[8]=e=>o.value.t_name=e),label:"Program Name",outlined:"",required:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),l(u,{modelValue:o.value.t_description,"onUpdate:modelValue":t[9]||(t[9]=e=>o.value.t_description=e),label:"Description",type:"textarea",outlined:"",rows:"3"},null,8,["modelValue"]),n("div",We,[n("div",Je,[l(u,{modelValue:o.value.t_start_date,"onUpdate:modelValue":[t[10]||(t[10]=e=>o.value.t_start_date=e),k],type:"date",label:"Start Date",outlined:"",required:""},null,8,["modelValue"])]),n("div",Ye,[l(u,{modelValue:o.value.t_end_date,"onUpdate:modelValue":[t[11]||(t[11]=e=>o.value.t_end_date=e),k],type:"date",label:"End Date",outlined:"",required:""},null,8,["modelValue"])])]),l(u,{modelValue:o.value.t_duration,"onUpdate:modelValue":t[12]||(t[12]=e=>o.value.t_duration=e),modelModifiers:{number:!0},label:"Duration (days)",type:"number",outlined:"",readonly:""},null,8,["modelValue"]),l(u,{modelValue:o.value.t_eligibility,"onUpdate:modelValue":t[13]||(t[13]=e=>o.value.t_eligibility=e),label:"Eligibility Criteria",outlined:""},null,8,["modelValue"])]),n("div",Ze,[l(u,{modelValue:o.value.t_organizer,"onUpdate:modelValue":t[14]||(t[14]=e=>o.value.t_organizer=e),label:"Organizer",outlined:""},null,8,["modelValue"]),l(u,{modelValue:o.value.t_capacity,"onUpdate:modelValue":t[15]||(t[15]=e=>o.value.t_capacity=e),modelModifiers:{number:!0},label:"Capacity",type:"number",outlined:"",hint:"-1 for unlimited"},null,8,["modelValue"]),l(F,{modelValue:o.value.t_room,"onUpdate:modelValue":t[16]||(t[16]=e=>o.value.t_room=e),options:$.value,label:"Select Room",outlined:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"]),l(F,{modelValue:o.value.t_category,"onUpdate:modelValue":t[17]||(t[17]=e=>o.value.t_category=e),options:S.value,label:"Select Category",outlined:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"]),n("div",null,[t[27]||(t[27]=n("div",{class:"text-caption q-mb-xs"},"Program Banner",-1)),l(xe,{modelValue:o.value.t_banner,"onUpdate:modelValue":t[18]||(t[18]=e=>o.value.t_banner=e),accept:"image/*",outlined:"",label:"Choose banner image",clearable:"","max-file-size":"5242880",onRejected:le},{prepend:r(()=>[l(f,{name:"attach_file"})]),_:1},8,["modelValue"]),t[28]||(t[28]=n("div",{class:"text-caption text-grey"}," Max size: 5MB (JPG, PNG, GIF) ",-1)),o.value.t_banner?(q(),Q("div",He,[t[26]||(t[26]=n("div",{class:"text-caption"},"Preview:",-1)),l(I,{src:te(o.value.t_banner),style:{"max-width":"200px","max-height":"100px"},class:"q-mt-xs rounded-borders"},null,8,["src"])])):B("",!0)])])]),n("div",Ke,[L(l(m,{flat:"",label:"Cancel",color:"negative"},null,512),[[j]]),l(m,{type:"submit",label:p.value?"Update":"Save",color:"primary",loading:R.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Qt as default};
