import{y as F,k as g,I as _,s,J as T,K as O,p as l,n as o,L as U,M as V,O as i,a0 as z,Q as k,X as $,U as J,N as L,a7 as K,a5 as X,a3 as b,f as C,r,$ as G,q as d,W as H,a6 as Y}from"./index-BFQVnkeD.js";import{Q as Z}from"./QChip-DfQm8PkW.js";import{Q as ee}from"./QRating-DRnZi58G.js";import{Q as te}from"./QImg-CZMqGg2f.js";import{Q as ae}from"./QPagination-3NT97Nxz.js";import{Q as P}from"./QSelect-JXd70JCl.js";import{Q as le}from"./QSpace-CsGAL2gM.js";import{Q as se}from"./QTd-BWciSjZm.js";import{Q as oe}from"./QTable-DXP6WPMu.js";import{Q as ne}from"./QInnerLoading-DErjiOez.js";import{C as ie}from"./ClosePopup-C7U-2yK_.js";import{u as re}from"./use-quasar-DANKxKaF.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./format-DyQxkAtJ.js";import"./QItemSection-DwMX_uwU.js";import"./QItemLabel-CE04gojx.js";import"./QMenu-_RHIY6Py.js";import"./position-engine-C7g5UB-x.js";import"./selection-Bt0zPBy8.js";import"./rtl-DFPa-2ov.js";import"./QList-DRW5wzJ9.js";import"./QLinearProgress-BEJ3yK6Z.js";import"./use-fullscreen-CLRBxuHX.js";const ue={class:"q-pa-md"},me={class:"row q-col-gutter-lg"},ce={key:0,class:"absolute-full flex flex-center bg-grey-4 text-grey-7"},pe={class:"absolute-bottom bg-gradient-to-top from-black/70 text-white q-pa-md"},ve={class:"text-h6 q-mb-xs ellipsis"},fe={class:"text-caption ellipsis"},ge={class:"row items-center justify-between q-mt-xs"},_e={class:"row items-center"},be={class:"text-caption q-ml-xs"},he={class:"text-caption"},xe={class:"text-caption"},ye={class:"text-caption"},we={class:"text-caption"},Qe={class:"text-caption"},Ve={class:"q-mt-lg q-pa-md flex flex-center column"},Ce={class:"text-h6"},Pe={class:"row q-gutter-sm q-mb-md items-center"},qe={__name:"EnrollmentPage",setup(Ee){const h=re(),x=r(!1),q=r([]),y=r([]),w=r(!1),c=r(null),Q=r(1),u=r(6),p=r(""),v=r("all"),E=a=>a?new Date(a).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"N/A",N=a=>a?a.startsWith("http")?a:a.startsWith("/")?`${b.defaults.baseURL}${a}`:`${b.defaults.baseURL}/uploads/${a}`:"",R=a=>({Upcoming:"blue",Ongoing:"green",Finished:"grey"})[a]||"primary",D=C(()=>{const a=(Q.value-1)*u.value,e=a+u.value;return y.value.slice(a,e)}),A=C(()=>Math.max(1,Math.ceil(y.value.length/u.value))),B=[{name:"name",label:"Name",field:a=>a.user.full_name,align:"left"},{name:"email",label:"Email",field:a=>a.user.email,align:"left"},{name:"mobile",label:"Mobile",field:a=>a.user.mobile,align:"left"},{name:"status",label:"Status",field:"status",align:"center"},{name:"actions",label:"Actions",field:"actions",align:"right"}],I=[{label:"Approved",value:"Approved"},{label:"Pending",value:"Pending"},{label:"Rejected",value:"Rejected"},{label:"Waitlisted",value:"Waitlisted"}],W=async()=>{x.value=!0;try{let a=[],e=1,t=1;do{const m=await b.get("/admin-api/enrollments",{params:{page:e,limit:""}});a.push(...m.data.enrollments||[]),t=m.data.pagination.totalPages,e++}while(e<=t);q.value=a;const n={};q.value.forEach(m=>{const f=m.training_program;n[f._id]||(n[f._id]={...f,enrollments:[]}),n[f._id].enrollments.push(m)}),y.value=Object.values(n)}catch(a){console.error("Fetch error:",a)}finally{x.value=!1}},S=a=>{c.value=a,w.value=!0},M=C(()=>c.value?c.value.enrollments.filter(a=>{const e=a.user.full_name.toLowerCase().includes(p.value.toLowerCase())||a.user.email.toLowerCase().includes(p.value.toLowerCase()),t=v.value==="all"||a.status===v.value;return e&&t}):[]),j=async a=>{try{await b.patch(`/admin-api/enrollment/${a._id}`,{status:a.status}),h.notify({type:"positive",message:`Status updated to ${a.status}`})}catch(e){const t=e.response?.data?.message||e.response?.data?.error||"Failed to update status";e.response?.status===400&&t.includes("Training capacity reached")?h.notify({type:"warning",message:"Training capacity reached! Enrollment moved to Waitlist."}):(console.error("Status update failed:",e.response?.data||e.message),h.notify({type:"negative",message:t}))}};return F(W),(a,e)=>(g(),_("div",ue,[e[11]||(e[11]=s("div",{class:"text-h5 text-weight-bold q-mb-lg"},"Program Enrollments",-1)),s("div",me,[(g(!0),_(T,null,O(D.value,t=>(g(),_("div",{key:t._id,class:"col-12 col-md-6 col-lg-4"},[l(U,{flat:"",bordered:"",class:"hoverable-card cursor-pointer",onClick:n=>S(t)},{default:o(()=>[l(te,{src:N(t.t_banner),ratio:16/9,alt:"Program Banner",class:"rounded-t-borders"},{default:o(()=>[t.t_banner?G("",!0):(g(),_("div",ce,[l(L,{name:"image",size:"48px",class:"q-mr-sm"}),e[5]||(e[5]=s("div",null,"No Banner Available",-1))])),s("div",pe,[s("div",ve,i(t.t_name),1),s("div",fe,i(t.t_description),1),s("div",ge,[l(Z,{dense:"",color:R(t.t_status),"text-color":"white"},{default:o(()=>[d(i(t.t_status),1)]),_:2},1032,["color"]),s("div",_e,[l(ee,{modelValue:t.averageRating,"onUpdate:modelValue":n=>t.averageRating=n,max:"5",color:"amber",readonly:"",size:"16px"},null,8,["modelValue","onUpdate:modelValue"]),s("span",be,"("+i(t.ratingsCount||0)+")",1)])])])]),_:2},1032,["src"]),l(V,null,{default:o(()=>[s("div",he,[e[6]||(e[6]=s("b",null,"Start:",-1)),d(" "+i(E(t.t_start_date)),1)]),s("div",xe,[e[7]||(e[7]=s("b",null,"End:",-1)),d(" "+i(E(t.t_end_date)),1)]),s("div",ye,[e[8]||(e[8]=s("b",null,"Duration:",-1)),d(" "+i(t.t_duration)+" days",1)]),s("div",we,[e[9]||(e[9]=s("b",null,"Capacity:",-1)),d(" "+i(t.t_capacity),1)]),s("div",Qe,[e[10]||(e[10]=s("b",null,"Enrollments:",-1)),d(" "+i(t.enrollments.length),1)])]),_:2},1024),l($),l(H,{align:"right"},{default:o(()=>[l(k,{color:"primary",flat:"",icon:"people",label:"View Enrollments",onClick:Y(n=>S(t),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]),s("div",Ve,[l(ae,{modelValue:Q.value,"onUpdate:modelValue":e[0]||(e[0]=t=>Q.value=t),max:A.value,"max-pages":"7","boundary-numbers":"","direction-links":"",color:"primary",class:"q-mb-md"},null,8,["modelValue","max"]),l(P,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),options:[6,12,24],label:"Rows per page",outlined:"",dense:"",style:{width:"150px"}},null,8,["modelValue"])]),l(K,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=t=>w.value=t)},{default:o(()=>[l(U,{style:{"min-width":"700px","max-width":"90vw"}},{default:o(()=>[l(V,{class:"row items-center q-pb-none"},{default:o(()=>[s("div",Ce,i(c.value?.t_name)+" - Enrollments",1),l(le),z(l(k,{dense:"",flat:"",icon:"close"},null,512),[[ie]])]),_:1}),l($),l(V,null,{default:o(()=>[s("div",Pe,[l(J,{dense:"",outlined:"",debounce:"300",modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),placeholder:"Search user/email",clearable:""},{append:o(()=>[l(L,{name:"search"})]),_:1},8,["modelValue"]),l(P,{dense:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),options:["all","Approved","Pending","Waitlisted","Rejected"],style:{"min-width":"150px"}},null,8,["modelValue"])]),l(oe,{rows:M.value,columns:B,"row-key":"_id",flat:"",bordered:""},{"body-cell-actions":o(t=>[l(se,{align:"right"},{default:o(()=>[l(P,{dense:"",outlined:"",modelValue:t.row.status,"onUpdate:modelValue":[n=>t.row.status=n,n=>j(t.row)],options:I,"emit-value":"","map-options":"",style:{"min-width":"120px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["rows"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ne,{showing:x.value},{default:o(()=>[l(X,{color:"primary",size:"50px"})]),_:1},8,["showing"])]))}},Ye=de(qe,[["__scopeId","data-v-53e3b02a"]]);export{Ye as default};
