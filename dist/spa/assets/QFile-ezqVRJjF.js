import{Q as w}from"./QChip-CTRFJQAs.js";import{a as B,aD as G,aE as H,aF as J,g as M,aG as T,d as s,f as i,aH as x,aI as U,aJ as W,r as V,aK as X,aL as Y,aM as Z}from"./index-05LJQMJY.js";import{u as ee,a as te,b as le}from"./use-file-BJTEmDmu.js";import{h as ae}from"./format-DyQxkAtJ.js";const oe=B({name:"QFile",inheritAttrs:!1,props:{...J,...H,...te,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...G,...ee],setup(e,{slots:r,emit:S,attrs:p}){const{proxy:v}=M(),u=T(),o=V(null),g=V(!1),A=Z(e),{pickFiles:I,onDragover:j,onDragleave:P,processFiles:N,getDndNode:O}=le({editable:u.editable,dnd:g,getFileInput:h,addFilesToQueue:C}),q=Y(e),l=i(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),b=i(()=>x(l.value)),D=i(()=>l.value.map(t=>t.name).join(", ")),F=i(()=>ae(l.value.reduce((t,a)=>t+a.size,0))),L=i(()=>({totalSize:F.value,filesNumber:l.value.length,maxFiles:e.maxFiles})),Q=i(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:A.value,...p,id:u.targetUid.value,disabled:u.editable.value!==!0})),_=i(()=>"q-file q-field--auto-height"+(g.value===!0?" q-file--dnd":"")),y=i(()=>e.multiple===!0&&e.append===!0);function d(t){const a=l.value.slice();a.splice(t,1),f(a)}function k(t){const a=l.value.indexOf(t);a!==-1&&d(a)}function f(t){S("update:modelValue",e.multiple===!0?t:t[0])}function E(t){t.keyCode===13&&X(t)}function z(t){(t.keyCode===13||t.keyCode===32)&&I(t)}function h(){return o.value}function C(t,a){const n=N(t,a,l.value,y.value),m=h();m!=null&&(m.value=""),n!==void 0&&((e.multiple===!0?e.modelValue&&n.every($=>l.value.includes($)):e.modelValue===n[0])||f(y.value===!0?l.value.concat(n):n))}function c(){return[s("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function K(){if(r.file!==void 0)return l.value.length===0?c():l.value.map((a,n)=>r.file({index:n,file:a,ref:this}));if(r.selected!==void 0)return l.value.length===0?c():r.selected({files:l.value,ref:this});if(e.useChips===!0)return l.value.length===0?c():l.value.map((a,n)=>s(w,{key:"file-"+n,removable:u.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{d(n)}},()=>s("span",{class:"ellipsis",textContent:a.name})));const t=e.displayValue!==void 0?e.displayValue:D.value;return t.length!==0?[s("div",{class:e.inputClass,style:e.inputStyle,textContent:t})]:c()}function R(){const t={ref:o,...Q.value,...q.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:C};return e.multiple===!0&&(t.multiple=!0),s("input",t)}return Object.assign(u,{fieldClass:_,emitValue:f,hasValue:b,inputRef:o,innerValue:l,floatingLabel:i(()=>b.value===!0||x(e.displayValue)),computedCounter:i(()=>{if(e.counterLabel!==void 0)return e.counterLabel(L.value);const t=e.maxFiles;return`${l.value.length}${t!==void 0?" / "+t:""} (${F.value})`}),getControlChild:()=>O("file"),getControl:()=>{const t={ref:u.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return u.editable.value===!0&&Object.assign(t,{onDragover:j,onDragleave:P,onKeydown:E,onKeyup:z}),s("div",t,[R()].concat(K()))}}),Object.assign(v,{removeAtIndex:d,removeFile:k,getNativeElement:()=>o.value}),U(v,"nativeEl",()=>o.value),W(u)}});export{oe as Q};
