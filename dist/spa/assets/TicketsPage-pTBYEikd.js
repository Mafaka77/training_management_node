import{y as $,k as n,m as D,n as o,s,p as a,Q as y,I as m,J as N,K as j,L as h,O as r,q as v,M as f,N as O,a7 as F,U as q,W as U,a0 as B,a3 as b,Y as u,r as c}from"./index-DC0YMQbz.js";import{Q as P}from"./QBadge-BRpsS5UQ.js";import{Q as z}from"./QBanner-XmarimsX.js";import{Q as R}from"./QSelect-DOmEJooZ.js";import{Q as E}from"./QSpace-CiKONr1w.js";import{Q as G}from"./QPage-2gbvGW61.js";import{C as S}from"./ClosePopup-kboo78GW.js";import{d as H}from"./date-Cal6B8O-.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-BibKkBpH.js";import"./QItemSection-BSXlGEOh.js";import"./QItemLabel-q_FOaNxy.js";import"./QMenu-0kKoSyiK.js";import"./position-engine-BXB3iCbd.js";import"./selection-Ck0Kmbg0.js";import"./rtl-DFPa-2ov.js";import"./format-DyQxkAtJ.js";const K={class:"row items-center justify-between q-mb-lg"},W={key:0,class:"row q-col-gutter-md"},X={class:"ticket-header flex items-center justify-between q-pa-sm bg-primary text-white rounded-top"},Z={class:"text-h6 ellipsis"},ee={class:"text-caption text-grey"},te={class:"text-caption text-grey"},se={class:"text-caption text-grey"},ae={class:"text-body2 ellipsis-2-lines q-mt-sm"},le={class:"ticket-banner bg-primary text-white flex items-center q-pa-md"},oe={class:"text-h6"},ie={class:"row q-col-gutter-md q-mb-md"},re={class:"col-6"},de={class:"col-6"},ne={class:"q-mb-md"},ue={class:"text-body2 q-mt-sm"},ce={key:0},me={class:"text-caption text-grey"},pe={key:1,class:"text-grey q-mb-sm"},ve={class:"text-right q-mt-sm"},ye={__name:"TicketsPage",setup(ge){const k=c([]),g=c(!1),x=c(!1),i=c(null),w=c(!1),_=c(!1),p=c(""),d=c({subject:"",description:"",category:"Technical",priority:"Low"}),A=["Technical","General","Billing","Account"],M=["Low","Medium","High"],V=async()=>{try{const l=await b.get("/api/tickets");k.value=l.data.tickets||[]}catch(l){console.error("Failed to fetch tickets:",l),u.create({type:"negative",message:"Failed to fetch tickets."})}},I=async l=>{if(!l?._id){u.create({type:"negative",message:"Ticket ID not found"});return}try{const e=await b.get(`/api/tickets/${l._id}`);i.value=e.data.ticket,x.value=!0}catch(e){console.error("Failed to fetch ticket:",e),u.create({type:"negative",message:"Failed to fetch ticket."})}},L=async()=>{if(!d.value.subject||!d.value.description){u.create({type:"warning",message:"Please fill all required fields."});return}w.value=!0;try{await b.post("/api/tickets",d.value),u.create({type:"positive",message:"Ticket raised successfully."}),g.value=!1,d.value={subject:"",description:"",category:"Technical",priority:"Low"},V()}catch(l){console.error("Failed to raise ticket:",l),u.create({type:"negative",message:"Failed to raise ticket."})}finally{w.value=!1}},Y=async()=>{if(!(!p.value.trim()||!i.value?._id)){_.value=!0;try{const l=await b.post(`/api/ticket/${i.value._id}/reply`,{message:p.value});i.value=l.data.ticket,p.value="",u.create({type:"positive",message:"Reply sent successfully."})}catch(l){console.error("Failed to send reply:",l),u.create({type:"negative",message:"Failed to send reply."})}finally{_.value=!1}}},C=l=>({Open:"orange",Closed:"grey",Resolved:"green"})[l]||"blue",T=l=>H.formatDate(l,"DD MMM YYYY, hh:mm A");return $(V),(l,e)=>(n(),D(G,{class:"q-pa-md bg-grey-1"},{default:o(()=>[s("div",K,[e[8]||(e[8]=s("div",{class:"text-h5 text-weight-bold"},"Support Tickets",-1)),a(y,{color:"primary",label:"Raise New Ticket",icon:"add_circle",onClick:e[0]||(e[0]=t=>g.value=!0)})]),k.value.length?(n(),m("div",W,[(n(!0),m(N,null,j(k.value,t=>(n(),m("div",{key:t._id,class:"col-12 col-md-6"},[a(h,{flat:"",bordered:"",class:"ticket-card hover-scale q-mb-md",onClick:Q=>I(t)},{default:o(()=>[s("div",X,[s("div",Z,r(t.subject),1),a(P,{color:C(t.status),class:"text-white"},{default:o(()=>[v(r(t.status),1)]),_:2},1032,["color"])]),a(f,{class:"q-pa-sm"},{default:o(()=>[s("div",ee,"Category: "+r(i.value?.category),1),s("div",te,"Priority: "+r(i.value?.priority),1),s("div",se,"Created At: "+r(T(t?.createdAt)),1),s("p",ae,r(t?.description),1)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])):(n(),D(z,{key:1,class:"bg-grey-3 text-center q-pa-xl"},{default:o(()=>[a(O,{name:"support_agent",size:"64px",color:"grey-5"}),e[9]||(e[9]=s("div",{class:"text-h6 q-mt-md"},"No tickets found",-1)),e[10]||(e[10]=s("div",{class:"text-subtitle2"},'Click "Raise New Ticket" to create one.',-1))]),_:1})),a(F,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),persistent:""},{default:o(()=>[a(h,{style:{"max-width":"500px",width:"100%"},class:"rounded-borders shadow-2"},{default:o(()=>[a(f,{class:"bg-primary text-white text-h6 rounded-top"},{default:o(()=>[...e[11]||(e[11]=[v("Raise a New Ticket",-1)])]),_:1}),a(f,{class:"q-pa-md"},{default:o(()=>[a(q,{modelValue:d.value.subject,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.subject=t),label:"Subject",outlined:"",dense:"",class:"q-mb-sm"},null,8,["modelValue"]),a(q,{modelValue:d.value.description,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.description=t),label:"Description",type:"textarea",outlined:"",dense:"",class:"q-mb-sm"},null,8,["modelValue"]),a(R,{modelValue:d.value.category,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.category=t),options:A,label:"Category",outlined:"",dense:"",class:"q-mb-sm"},null,8,["modelValue"]),a(R,{modelValue:d.value.priority,"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.priority=t),options:M,label:"Priority",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),a(U,{align:"right",class:"q-pa-md"},{default:o(()=>[B(a(y,{flat:"",label:"Cancel"},null,512),[[S]]),a(y,{color:"primary",label:"Submit",loading:w.value,onClick:L},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(F,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=t=>x.value=t)},{default:o(()=>[a(h,{style:{"max-width":"700px",width:"100%"},class:"rounded-borders shadow-2"},{default:o(()=>[s("div",le,[s("div",oe,r(i.value?.subject),1),a(E),a(P,{color:C(i.value?.status),class:"text-white"},{default:o(()=>[v(r(i.value?.status),1)]),_:1},8,["color"])]),a(f,{class:"scroll q-pa-md",style:{"max-height":"70vh","overflow-y":"auto"}},{default:o(()=>[s("div",ie,[s("div",re,[e[12]||(e[12]=s("strong",null,"Category:",-1)),v(" "+r(i.value?.category),1)]),s("div",de,[e[13]||(e[13]=s("strong",null,"Priority:",-1)),v(" "+r(i.value?.priority),1)])]),s("div",ne,[e[14]||(e[14]=s("strong",null,"Description:",-1)),e[15]||(e[15]=v()),s("p",ue,r(i.value?.description),1)]),e[16]||(e[16]=s("div",{class:"text-subtitle2 q-mb-sm"},"Replies",-1)),i.value?.replies?.length?(n(),m("div",ce,[(n(!0),m(N,null,j(i.value.replies,(t,Q)=>(n(),m("div",{key:Q,class:"q-pa-sm bg-grey-2 q-mb-sm rounded-borders shadow-1"},[s("div",me,r(t.user?.email||t.sender?.email||"Unknown")+" â€¢ "+r(T(t.createdAt)),1),s("div",null,r(t.message),1)]))),128))])):(n(),m("div",pe,"No replies yet.")),e[17]||(e[17]=s("div",{class:"text-subtitle2 q-mt-md q-mb-sm"},"Add Reply",-1)),a(q,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),type:"textarea",outlined:"",placeholder:"Type your reply...",autogrow:"",dense:""},null,8,["modelValue"]),s("div",ve,[a(y,{color:"primary",label:"Send",icon:"send",loading:_.value,disable:!p.value.trim(),onClick:Y},null,8,["loading","disable"])])]),_:1}),a(U,{align:"right",class:"q-pa-md"},{default:o(()=>[B(a(y,{flat:"",label:"Close",color:"primary"},null,512),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Be=J(ye,[["__scopeId","data-v-2edba835"]]);export{Be as default};
