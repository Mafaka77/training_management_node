import{ak as R,J as j,ag as y,k as w,W as N,p as a,al as T,Q as v,n as s,s as o,$ as E,a0 as n,q as d,Z as x,m as W,ac as z,a8 as J,_ as Z,aj as G,a5 as m,ad as H,ai as K,r as u,f as c}from"./index-Bzn0LiPU.js";import{Q as X}from"./QImg-B-Xiv_j_.js";import{Q as B}from"./QBadge-CCt-JOPv.js";import{Q as Y}from"./QTooltip-bg_yg9Hm.js";import{Q as V}from"./QTd-Bjv19h1_.js";import{Q as ee}from"./QPagination-DTvbNWWr.js";import{Q as te}from"./QTable-C7Me2Ftf.js";import{Q as ae}from"./QSelect-ChM7-dt3.js";import{Q as oe}from"./QForm-FpFFQh9P.js";import{C as le}from"./ClosePopup-C6H1DDOC.js";import"./position-engine-BCFNfW53.js";import"./selection-DFkNIa7B.js";import"./format-DyQxkAtJ.js";import"./QList-BSRIgFgv.js";import"./QLinearProgress-DAd5lNjJ.js";import"./use-fullscreen-2nc3m1XY.js";import"./QChip-COUtrNlO.js";import"./QItemSection-COOhA9zR.js";import"./QItemLabel-BQHMT6Ru.js";import"./QMenu-2e4m313B.js";import"./rtl-DFPa-2ov.js";const se={key:0,class:"flex flex-center q-pa-xl"},re={key:1,class:"q-pa-md"},ie={class:"row q-col-gutter-xl items-start"},ne={class:"col-3"},de={class:"absolute-full flex flex-center"},ue={class:"absolute-full flex flex-center bg-grey-2"},ce={class:"col-9"},me={class:"text-h4 text-weight-bold q-mb-sm"},pe={class:"text-body1 text-grey-7 q-mb-md"},_e={class:"row q-col-gutter-md text-body2"},ve={class:"col-6"},ge={class:"col-6"},fe={class:"col-6"},be={class:"col-6"},ye={class:"sticky-course-header q-pa-sm q-mb-sm"},we={class:"row items-center"},xe={class:"col"},Ve={class:"row items-center q-gutter-sm"},Qe={class:"text-caption text-grey"},he={class:"col-auto"},Ce={class:"text-weight-medium"},qe={class:"text-caption text-grey-7"},De={class:"text-caption text-grey-7"},Se={class:"row justify-center q-pa-md"},ke={class:"row q-col-gutter-sm"},Pe={class:"row justify-end q-gutter-sm"},Q=5,Ye={__name:"ProgramDetailPage",setup(Ue){const h=R(),C=u(!0),g=u(!1),r=u({}),p=u([]),_=u(!1),f=u(1),I=c(()=>p.value.length>0),b=c(()=>r.value.trainingCourse?r.value.trainingCourse.map(t=>({...t,trainerName:p.value.find(e=>e._id===t.trainer)?.full_name||""})):[]),q=c(()=>b.value.length),D=c(()=>r.value.t_capacity==null?!1:q.value>=r.value.t_capacity),$=c(()=>Math.ceil(b.value.length/Q)),A=c(()=>{const t=(f.value-1)*Q;return b.value.slice(t,t+Q)}),S=c(()=>p.value.map(t=>({label:t.full_name,value:t._id}))),O=[{name:"topic",label:"TOPIC",field:t=>t.tc_topic,align:"left",sortable:!0},{name:"dates",label:"DATES",field:t=>t.tc_start_time,sortable:!0,sort:(t,e)=>new Date(t)-new Date(e)},{name:"trainer",label:"TRAINER",field:t=>t.trainerName,sortable:!0}],F=t=>t?t.startsWith("http")?t:t.startsWith("/uploads")?`${window.location.origin}${t}`:t:"",k=t=>new Date(t).toLocaleDateString(),P=t=>new Date(t).toLocaleString(),L=t=>({Upcoming:"secondary",Ongoing:"orange",Finished:"green"})[t]||"grey";async function U(){const t=await y.get(`/admin-api/program/${h.params.id}`);r.value=t.data.trainingProgram}async function M(){g.value=!0,await y.post("/admin-api/submit-training-course",{...i.value,t_program:h.params.id,tc_start_time:new Date(i.value.tc_start_time).toISOString(),tc_end_time:new Date(i.value.tc_end_time).toISOString()}),_.value=!1,await U(),g.value=!1,i.value={tc_topic:"",tc_description:"",tc_start_time:"",tc_end_time:"",tc_session:1,trainer:null}}const i=u({tc_topic:"",tc_description:"",tc_start_time:"",tc_end_time:"",tc_session:1,trainer:null});return j(async()=>{p.value=(await y.get("/admin-api/get-trainer")).data.trainers||[],await U(),C.value=!1}),(t,e)=>C.value?(w(),N("div",se,[a(T,{color:"primary",size:"50px"})])):(w(),N("div",re,[a(v,{flat:"",icon:"arrow_back",label:"Back to Programs",class:"q-mb-md",onClick:e[0]||(e[0]=l=>t.$router.back())}),a(x,{flat:"",bordered:"",class:"q-pa-lg q-mb-lg"},{default:s(()=>[o("div",ie,[o("div",ne,[a(X,{src:F(r.value.t_banner),ratio:"16/9",class:"rounded-borders",style:{"min-height":"180px"},"spinner-color":"primary"},{loading:s(()=>[o("div",de,[a(T,{color:"primary"})])]),error:s(()=>[o("div",ue,[a(E,{name:"image",size:"48px",color:"grey-6"})])]),_:1},8,["src"])]),o("div",ce,[o("div",me,n(r.value.t_name),1),o("div",pe,n(r.value.t_description||"—"),1),o("div",_e,[o("div",ve,[e[10]||(e[10]=o("b",null,"Duration:",-1)),d(" "+n(r.value.t_duration)+" days",1)]),o("div",ge,[e[11]||(e[11]=o("b",null,"Capacity:",-1)),d(" "+n(r.value.t_capacity??"Unlimited"),1)]),o("div",fe,[e[12]||(e[12]=o("b",null,"Dates:",-1)),d(" "+n(k(r.value.t_start_date))+" – "+n(k(r.value.t_end_date)),1)]),o("div",be,[e[13]||(e[13]=o("b",null,"Status:",-1)),a(B,{color:L(r.value.t_status)},{default:s(()=>[d(n(r.value.t_status),1)]),_:1},8,["color"])])])])])]),_:1}),o("div",ye,[o("div",we,[o("div",xe,[o("div",Ve,[e[14]||(e[14]=o("div",{class:"text-h5"},"Courses in this Program",-1)),a(B,{color:"primary",outline:""},{default:s(()=>[d(n(q.value)+" / "+n(r.value.t_capacity??"∞"),1)]),_:1})]),o("div",Qe,n(r.value.t_name),1)]),o("div",he,[a(v,{color:"primary",icon:"add",label:"Add Course",disable:r.value.t_status==="Finished"||!I.value||D.value,onClick:e[1]||(e[1]=l=>_.value=!0)},{default:s(()=>[D.value?(w(),W(Y,{key:0},{default:s(()=>[...e[15]||(e[15]=[d(" Course capacity reached ",-1)])]),_:1})):z("",!0)]),_:1},8,["disable"])])])]),a(J,{class:"q-mb-md"}),a(x,{flat:"",bordered:""},{default:s(()=>[a(te,{flat:"",rows:A.value,columns:O,"row-key":"_id",class:"sticky-header-table","no-data-label":"No courses found for this program"},{"body-cell-topic":s(l=>[a(V,{props:l},{default:s(()=>[o("div",Ce,n(l.row.tc_topic),1),o("div",qe,n(l.row.tc_description||"No description"),1)]),_:2},1032,["props"])]),"body-cell-dates":s(l=>[a(V,{props:l},{default:s(()=>[d(n(P(l.row.tc_start_time))+" ",1),o("div",De," to "+n(P(l.row.tc_end_time)),1)]),_:2},1032,["props"])]),"body-cell-trainer":s(l=>[a(V,{props:l},{default:s(()=>[d(n(l.row.trainerName||"—"),1)]),_:2},1032,["props"])]),bottom:s(()=>[o("div",Se,[a(ee,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),max:$.value,"max-pages":6,"boundary-numbers":"",color:"primary"},null,8,["modelValue","max"])])]),_:1},8,["rows"])]),_:1}),a(K,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=l=>_.value=l),persistent:""},{default:s(()=>[a(x,{style:{"min-width":"500px"},class:"q-pa-md"},{default:s(()=>[a(Z,{class:"text-h6"},{default:s(()=>[...e[16]||(e[16]=[d(" Add Course ",-1)])]),_:1}),a(oe,{onSubmit:G(M,["prevent"]),class:"q-gutter-md"},{default:s(()=>[a(m,{label:"Program","model-value":r.value.t_name,readonly:"",outlined:""},null,8,["model-value"]),a(m,{modelValue:i.value.tc_topic,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.tc_topic=l),label:"Topic",outlined:"",required:""},null,8,["modelValue"]),a(m,{modelValue:i.value.tc_description,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.tc_description=l),label:"Description",type:"textarea",outlined:""},null,8,["modelValue"]),o("div",ke,[a(m,{class:"col-6",type:"datetime-local",modelValue:i.value.tc_start_time,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.tc_start_time=l),outlined:"",required:""},null,8,["modelValue"]),a(m,{class:"col-6",type:"datetime-local",modelValue:i.value.tc_end_time,"onUpdate:modelValue":e[6]||(e[6]=l=>i.value.tc_end_time=l),outlined:"",required:""},null,8,["modelValue"])]),a(m,{modelValue:i.value.tc_session,"onUpdate:modelValue":e[7]||(e[7]=l=>i.value.tc_session=l),modelModifiers:{number:!0},type:"number",label:"Sessions",outlined:"",min:"1"},null,8,["modelValue"]),a(ae,{modelValue:i.value.trainer,"onUpdate:modelValue":e[8]||(e[8]=l=>i.value.trainer=l),options:S.value,label:"Trainer",outlined:"","emit-value":"","map-options":"",clearable:"",disable:S.value.length===0,hint:"Select a trainer"},null,8,["modelValue","options","disable"]),o("div",Pe,[H(a(v,{flat:"",label:"Cancel"},null,512),[[le]]),a(v,{color:"primary",type:"submit",loading:g.value,label:"Add"},null,8,["loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ye as default};
