import{y as T,k as U,I as P,p as l,Q as c,n as s,U as n,N as x,L as N,M as b,s as V,X as $,a6 as k,a0 as h,a7 as B,a3 as d,r}from"./index-CyB-vvD0.js";import{Q as E}from"./QTable-JRsmzOW_.js";import{Q as y}from"./QSelect-CIQEfs4m.js";import{Q as M}from"./QForm-Bba9eP9N.js";import{C as R}from"./ClosePopup-Bhn8Avt2.js";import{u as I}from"./use-quasar-DLt-hrEL.js";import"./QList-DIiSaAAv.js";import"./QLinearProgress-NpaT5f6X.js";import"./use-fullscreen-BIddKg2O.js";import"./QChip-CzhZjiW0.js";import"./QItemSection-Z7u5r7C5.js";import"./QItemLabel-Ci-IQEZX.js";import"./QMenu-DpLiYxNU.js";import"./position-engine-JlRPGCg3.js";import"./selection-CPAv0goR.js";import"./rtl-DFPa-2ov.js";import"./format-DyQxkAtJ.js";const L={class:"q-pa-md"},A={class:"row justify-end q-gutter-sm"},se={__name:"TrainingCoursePage",setup(F){const w=I(),_=r([]),i=r(!1),g=r(!1),p=r(""),o=r({tc_topic:"",tc_description:"",tc_start_time:"",tc_end_time:"",tc_session:1,t_program:null,trainer:null,qrVersion:null}),u=r({page:1,rowsPerPage:10,rowsNumber:0}),v=r([]),f=r([]),D=[{name:"tc_topic",label:"Topic",field:"tc_topic",sortable:!0},{name:"tc_description",label:"Description",field:"tc_description"},{name:"tc_start_time",label:"Start Date",field:a=>new Date(a.tc_start_time).toLocaleDateString()},{name:"tc_end_time",label:"End Date",field:a=>new Date(a.tc_end_time).toLocaleDateString()},{name:"tc_session",label:"Sessions",field:"tc_session"},{name:"program",label:"Program",field:a=>a.t_program?.t_name||"-"},{name:"trainer",label:"Trainer",field:a=>a.trainer?.full_name||"-"}];async function Q(){try{const[a,t]=await Promise.all([d.get("/admin/get-all-training-program?page=1&limit=100&search="),d.get("/admin/get-trainer")]);v.value=a.data.programs||[],f.value=t.data.trainers||[]}catch(a){console.error("Dropdown fetch failed",a)}}const S=async()=>{try{const a=await d.post("/admin/submit-training-course",o.value);w.notify({type:"positive",message:a.data.message||"Training created successfully",caption:`Status: ${a.data.status}`,position:"top-right",timeout:3e3}),i.value=!1,o.value={tc_topic:"",tc_description:"",tc_start_time:"",tc_end_time:"",tc_session:1,t_program:null,trainer:null,qrVersion:null},m()}catch(a){console.error("Submit failed:",a)}};async function m(){g.value=!0;try{const{page:a,rowsPerPage:t}=u.value,e=await d.get(`/admin/get-all-training-course?page=${a}&limit=${t}&search=${p.value}`);_.value=e.data.courses||[],u.value.rowsNumber=e.data.total||0}catch(a){console.error("Error fetching courses",a)}finally{g.value=!1}}function C(a){u.value=a.pagination,m()}function q(){u.value.page=1,m()}return T(()=>{Q(),m()}),(a,t)=>(U(),P("div",L,[l(c,{color:"primary",icon:"add",label:"Add Training Course",onClick:t[0]||(t[0]=e=>i.value=!0),class:"q-mb-md"}),l(E,{class:"styled-table shadow-2 rounded-borders",flat:"",bordered:"",title:"Training Courses",rows:_.value,columns:D,"row-key":"_id",onRequest:C},{"top-right":s(()=>[l(n,{dense:"",debounce:"300",modelValue:p.value,"onUpdate:modelValue":[t[1]||(t[1]=e=>p.value=e),q],placeholder:"Search...",outlined:"",clearable:""},{append:s(()=>[l(x,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows"]),l(B,{modelValue:i.value,"onUpdate:modelValue":t[9]||(t[9]=e=>i.value=e),persistent:""},{default:s(()=>[l(N,{style:{"min-width":"500px"},class:"q-pa-md"},{default:s(()=>[l(b,null,{default:s(()=>[...t[10]||(t[10]=[V("div",{class:"text-h6 text-primary"},"Add New Course",-1)])]),_:1}),l($),l(b,{class:"q-gutter-md"},{default:s(()=>[l(M,{onSubmit:k(S,["prevent"]),class:"q-gutter-md"},{default:s(()=>[l(n,{modelValue:o.value.tc_topic,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.tc_topic=e),label:"Topic",outlined:""},null,8,["modelValue"]),l(n,{modelValue:o.value.tc_description,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.tc_description=e),label:"Description",type:"textarea",outlined:""},null,8,["modelValue"]),l(n,{modelValue:o.value.tc_start_time,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value.tc_start_time=e),label:"Start Date",type:"date",outlined:""},null,8,["modelValue"]),l(n,{modelValue:o.value.tc_end_time,"onUpdate:modelValue":t[5]||(t[5]=e=>o.value.tc_end_time=e),label:"End Date",type:"date",outlined:""},null,8,["modelValue"]),l(n,{modelValue:o.value.tc_session,"onUpdate:modelValue":t[6]||(t[6]=e=>o.value.tc_session=e),modelModifiers:{number:!0},label:"No. of Sessions",type:"number",outlined:""},null,8,["modelValue"]),l(y,{modelValue:o.value.t_program,"onUpdate:modelValue":t[7]||(t[7]=e=>o.value.t_program=e),options:v.value.map(e=>({label:e.t_name,value:e._id})),label:"Training Program",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),l(y,{modelValue:o.value.trainer,"onUpdate:modelValue":t[8]||(t[8]=e=>o.value.trainer=e),options:f.value.map(e=>({label:e.full_name,value:e._id})),label:"Trainer",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),V("div",A,[h(l(c,{flat:"",label:"Cancel",color:"negative"},null,512),[[R]]),l(c,{type:"submit",label:"Save",color:"primary"})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{se as default};
